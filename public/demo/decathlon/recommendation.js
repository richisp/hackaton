!function(t){function e(o){if(s[o])return s[o].exports;var i=s[o]={exports:{},id:o,loaded:!1};return t[o].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var s={};return e.m=t,e.c=s,e.p="",e(0)}([function(t,e,s){const o=s(1);window.woosmapRecommendation=new o},function(t,e,s){var o=s(2),i=!("undefined"==typeof console||"undefined"==typeof console.error),n=function(){this.apiManager=new o(this._launchRequests.bind(this)),this._isRequestingFromQueue=!1,this._abortRequesting=!1,this._setRequestsTimeout()};n.prototype._isApiManagerReady=function(){return!!this.apiManager.isReady()||(0===rRequestQueue.length&&(i&&null===this.apiManager.getProjectKey()&&console.error("You should set the project key before any other call. Please use recommendation.setProjectKey('mykey') or rRequestQueue.push(['setProjectKey', ['mykey']])"),this._abortRequesting=!0),!1)},n.prototype.setProjectKey=function(t){t!==this.apiManager.getProjectKey()&&this.apiManager.setProjectKey(t)},n.prototype.optIn=function(){this.apiManager.getProjectKey()?this._callMethodOrAddItToQueue("optIn"):i&&console.error("Projet key must be set to enable user profile.")},n.prototype.optOut=function(){this.apiManager.getProjectKey()?this._callMethodOrAddItToQueue("optOut"):i&&console.error("Projet key must be set to disable user profile.")},n.prototype._setRequestsTimeout=function(){var t=this;this._abortRequesting||setTimeout(function(){t._launchRequests()},500)},n.prototype._launchRequests=function(){for(this._isRequestingFromQueue=!0;rRequestQueue.length>0;){var t=rRequestQueue.shift(),e=this[t[0]];e?e.apply(this,t[1]):i&&console.error("Method "+t[0]+" does not exists.")}this._isRequestingFromQueue=!1,this._setRequestsTimeout()},n.prototype.sendUserBillingPosition=function(t){this._postUserPosition("billing_positions",t)},n.prototype.sendUserHtml5Position=function(t){this._postUserPosition("html5_positions",t)},n.prototype.sendUserBeaconPosition=function(t){this._postUserPosition("beacon_positions",t)},n.prototype.sendUserSearchedPosition=function(t){this._postUserPosition("searched_positions",t)},n.prototype.sendUserShippingPosition=function(t){this._postUserPosition("shipping_positions",t)},n.prototype.sendUserShippingPOI=function(t){this._postUserPosition("shipping_poi",t)},n.prototype.sendUserConsultedPOI=function(t){this._postUserPosition("consulted_poi",t)},n.prototype.sendUserFavoritedPOI=function(t){this._postUserPosition("favorited_poi",t)},n.prototype.sendCtaEvent=function(){this._callMethodOrAddItToQueue("postCtaEvent")},n.prototype._postUserPosition=function(t,e){this._callMethodOrAddItToQueue("postUserPosition",[t,e])},n.prototype.getUserRecommendation=function(t){this._callMethodOrAddItToQueue("getUserRecommendation",[t])},n.prototype.searchStores=function(t){this._callMethodOrAddItToQueue("searchStores",[t])},n.prototype.getUserPosition=function(t){this._callMethodOrAddItToQueue("getUserPosition",[t])},n.prototype._callMethodOrAddItToQueue=function(t,e){this._isApiManagerReady()?this.apiManager[t].apply(this.apiManager,e):this._pushInQueueIfNotRequesting(["_callMethodOrAddItToQueue",[t,e]])},n.prototype._pushInQueueIfNotRequesting=function(t){if(this._isRequestingFromQueue){var e=this;setTimeout(function(){e._pushInQueueIfNotRequesting(t)},100)}else rRequestQueue.push(t)},n.prototype.getConsent=function(t){this.apiManager.getProjectKey()?this._callMethodOrAddItToQueue("getConsent",[t]):i&&console.error("Projet key must be set get user consent.")},"undefined"==typeof rRequestQueue&&(rRequestQueue=[]),t.exports=n},function(t,e,s){var o=s(3).StorageManager,i=s(4),n={query:"query",maxDistance:"radius",limit:"limit",zone:"zone"},r={query:"query",maxDistance:"radius",limit:"limit",storesByPage:"stores_by_page",page:"page",lat:"lat",lng:"lng",zone:"zone"},a=0,u=1,c="SUCCESS_CB",h="ERROR_CB",p={SUCCESS_CB:a,ERROR_CB:u},l={CTA:"CTA_EVENT",RECOMMENDATION:"RECOMMENDATION_EVENT"},d=function(t){this.apiUrl="https://api.woosmap.com",this.projectKey=null,this._isReady=!1,this.userUid=null,this.trackingForProject=!1,this.readyCallback=t,this._waitingRequests={},this._initCachedData(),this._storageManager=new o,this._sessionManager=new i,this._isPostingSessionData=!1,this._waitingSessionEvents=[]};d.prototype.setProjectKey=function(t){this.projectKey=t,this.loadUserUid("true")},d.prototype._configureUser=function(t){this._isReady=!1,null!==this.userUid?this._requestAPI("POST",this._getUserConfigUrl(),!0,function(t){this._configureUserCallback(JSON.parse(t.responseText||"{}").tracking)}.bind(this),null,JSON.stringify({tracking:t}),"application/json"):this._configureUserCallback(t)},d.prototype._configureUserCallback=function(t){t?(this._storageManager.setConsent("true"),this.trackingForProject=!0,this.loadUserUid(!0)):(this.trackingForProject=!1,this._storageManager.removeAllData(),this._isReady=!0)},d.prototype.optIn=function(){this._configureUser(!0)},d.prototype.optOut=function(){this._configureUser(!1)},d.prototype._getUserConfigUrl=function(){return"/reco/projects/"+this.projectKey+"/users"},d.prototype._initCachedData=function(){this._cachedData={}},d.prototype._handleWaitingRequestCb=function(t,e,s){for(var o=0;o<this._waitingRequests[t].length;o++){var i=this._waitingRequests[t][o][p[e]];i&&i(s)}e===c&&(this._cachedData[t]=s),this._waitingRequests[t]=void 0},d.prototype._waitingRequestOnError=function(){var t=this;return function(e,s){t._handleWaitingRequestCb(s,h,e)}},d.prototype._waitingRequestOnSuccess=function(){var t=this;return function(e,s){t._handleWaitingRequestCb(s,c,e)}},d.prototype._requestOnEvent=function(t){var e=this;return function(s){e._initCachedData(),t&&t(s)}},d.prototype._getCrossDomainRequest=function(t,e,s){var o=null;return void 0===(new XMLHttpRequest).withCredentials?(o=new XDomainRequest,o.onerror=function(t){e(t.target,s)},o.onload=function(e){t(e.target,s)}):(o=new XMLHttpRequest,o.onload=function(){0===o.status.toString().indexOf("2")?t(o,s):e(o,s)}),o},d.prototype._requestAPI=function(t,e,s,o,i,n,r){var a,u;e.indexOf("users/uid")!==-1?(a=o,u=i):"GET"===t?(a=this._waitingRequestOnSuccess(),u=this._waitingRequestOnError()):(a=this._requestOnEvent(o),u=this._requestOnEvent(i));var c=this._getCrossDomainRequest(a,u,e);c.open(t,this.apiUrl+e.replace("{userUid}",this.userUid)),c.withCredentials=s||!1,c.setRequestHeader&&c.setRequestHeader("Content-Type",r||"text/plain"),c.send(n)},d.prototype.loadUserUid=function(t){if(this.userUid=this._storageManager.getUserUid(),this.trackingForProject=this._storageManager.getConsent(),null!==this.userUid)this._loadUserUidCallback();else{var e="/reco/projects/"+this.projectKey+"/users/uid?create="+t;this._getAPIData({successCallback:function(e){e=JSON.parse(e.responseText||"{}"),this.userUid=e.uid,this.trackingForProject=e.tracking,void 0===this.trackingForProject&&(this.trackingForProject=t),null!==this.userUid&&(this._storageManager.setUserUid(this.userUid),this._storageManager.setConsent(this.trackingForProject)),this._loadUserUidCallback()}.bind(this),withCredentials:!0},e)}},d.prototype._loadUserUidCallback=function(){this.trackingForProject&&this.updateSessionData(),this._isReady=!0,this.readyCallback&&this.readyCallback()},d.prototype.postUserPosition=function(t,e){this.consentRequired(function(){var s={lat:e.lat,lng:e.lng,id:e.id};this._requestAPI("POST",this._getPostUserPositionUrl(t),!1,e.successCallback,e.errorCallback,JSON.stringify(s),"application/json")},[t,e])},d.prototype.postCtaEvent=function(){this.consentRequired(function(){this._requestAPI("POST",this._getPostCtaUrl(),!1,function(){},function(){throw"Post CTA Event Failed"},JSON.stringify(""),"application/json"),this.updateSessionData(l.CTA)})},d.prototype.getUserRecommendation=function(t){var e=t.noCookie;delete t.noCookie,this.consentRequired(function(){this._getAPIData(t,this._buildUrl(this._getUserUrl(e)+"/recommendations",t,n,"getUserRecommendation"),l.RECOMMENDATION)},[t])},d.prototype.getUserPosition=function(t){var e=t.noCookie;delete t.noCookie,this.consentRequired(function(){this._getAPIData(t,this._getUserUrl(e)+"/position",l.RECOMMENDATION)},[t])},d.prototype.searchStores=function(t){this._getAPIData(t,this._buildUrl("/stores/search/",t,r,"searchStores"))},d.prototype._getAPIData=function(t,e,s){var o=this,i=function(e){var i=JSON.parse(e.responseText||"{}");s&&(i.latitude||i.features&&i.features.length>0)&&o.updateSessionData(s),t.successCallback(i)};if(e.indexOf("users/uid")!==-1)this._requestAPI("GET",e,t.withCredentials,t.successCallback);else if(void 0!==this._cachedData[e])i(this._cachedData[e]);else{var n=[i,t.errorCallback];void 0===this._waitingRequests[e]?(this._waitingRequests[e]=[n],this._requestAPI("GET",e,t.withCredentials)):this._waitingRequests[e].push(n)}},d.prototype.updateSessionData=function(t){this._waitingSessionEvents.push(t),this._shiftNextSessionEvent()},d.prototype._shiftNextSessionEvent=function(){if(this._waitingSessionEvents.length>0&&!this._isPostingSessionData){var t=this._waitingSessionEvents.shift();this._updateSessionManager(t),this._sessionManager.shouldPostSession()?this._postSessionData():this._shiftNextSessionEvent()}},d.prototype._updateSessionManager=function(t){t===l.CTA?this._sessionManager.addCtaEvent():t===l.RECOMMENDATION&&this._sessionManager.addRecommendationEvent()},d.prototype._postSessionDataCallback=function(t){this._sessionManager.onSessionPost(t),this._isPostingSessionData=!1,this._shiftNextSessionEvent()},d.prototype._postSessionData=function(){this._isPostingSessionData=!0,this._sessionManager.setCurrentSessionAsPosted(),this._requestAPI("POST",this._getPostSessionDataUrl(),!0,function(t){this._postSessionDataCallback(JSON.parse(t.responseText||"{}").sessionUid)}.bind(this),function(){throw"Post session data failed"},this._sessionManager.currentSession.toString(),"application/json")},d.prototype._getUserUrl=function(t){var e=t?"":"/users/{userUid}";return"/reco/projects/"+this.projectKey+e},d.prototype._getPostUserPositionUrl=function(t){return this._getUserUrl()+"/"+t+"/"},d.prototype._buildUrl=function(t,e,s,o){var i=[];return o=o||"Unknown caller",e&&(Object.keys(e).forEach(function(t){if(s.hasOwnProperty(t)){var n;n="boolean"==typeof e[t]?e[t]?"true":"false":e[t],i.push(s[t]+"="+encodeURIComponent(n))}else"successCallback"!==t&&"errorCallback"!==t&&console&&"function"==typeof console.error&&console.error("Parameter "+t+" is not supported by "+o+".")}),t.indexOf(this.projectKey)===-1&&i.push("key="+this.projectKey),i.length>0&&(t+="?"+i.join("&"))),t},d.prototype._getPostCtaUrl=function(){return"/reco/projects/"+this.projectKey+"/users/{userUid}/cta"},d.prototype._getPostSessionDataUrl=function(){return"/reco/projects/"+this.projectKey+"/users/{userUid}/session"},d.prototype.getProjectKey=function(){return this.projectKey},d.prototype.getConsent=function(t){t&&t(this._storageManager.getConsent())},d.prototype.consentRequired=function(t,e){var s=!("undefined"==typeof console||"undefined"==typeof console.error);this.projectKey?this.trackingForProject?t.apply(this,e):s&&console.error("No user consent. No tracking allowed"):s&&console.error("You should set the project key before any other call")},d.prototype.isReady=function(){return this.projectKey&&this._isReady},t.exports=d},function(t,e){var s={USER_UID:"woosmapUserUid",SESSION:"woosmapSession",CONSENT:"woosmapConsent"},o={SESSION_STORAGE:"session",LOCAL_STORAGE:"local"},i=function(){this.isStorageEnabled=!0,this.initializedStorage()};i.prototype.initializedStorage=function(){try{this._sessionStorage=window.sessionStorage,this._localStorage=window.localStorage}catch(t){this.isStorageEnabled=!1}},i.prototype._setItemLocal=function(t,e,s){return this._manageLocalItem("setItem",t,e,s)},i.prototype._getItemLocal=function(t,e){return this._manageLocalItem("getItem",t,null,e)},i.prototype._removeItemLocal=function(t,e){this._manageLocalItem("removeItem",t,null,e)},i.prototype._manageLocalItem=function(t,e,s,i){if(void 0===s)return null;try{return i===o.SESSION_STORAGE?this._sessionStorage[t](e,s):i===o.LOCAL_STORAGE?this._localStorage[t](e,s):null}catch(t){return null}},i.prototype.setUserUid=function(t){this._setItemLocal(s.USER_UID,t,o.SESSION_STORAGE)},i.prototype.getUserUid=function(){return this._getItemLocal(s.USER_UID,o.SESSION_STORAGE)},i.prototype.setSession=function(t){return this._setItemLocal(s.SESSION,t,o.LOCAL_STORAGE)},i.prototype.getSession=function(){return this._getItemLocal(s.SESSION,o.LOCAL_STORAGE)},i.prototype.getConsent=function(){return"true"===this._getItemLocal(s.CONSENT,o.SESSION_STORAGE)},i.prototype.setConsent=function(t){return this._setItemLocal(s.CONSENT,t,o.SESSION_STORAGE)},i.prototype.removeAllData=function(){this._removeItemLocal(s.SESSION,o.LOCAL_STORAGE),this._removeItemLocal(s.USER_UID,o.SESSION_STORAGE),this._setItemLocal(s.CONSENT,!1,o.SESSION_STORAGE)},t.exports={StorageManager:i,STORAGE_KEYS:s,STORAGE_TYPES:o}},function(t,e,s){var o=s(3).StorageManager,i=s(5),n=function(){this._storageManager=new o,this._initialize()};n.prototype._initialize=function(){var t=this._storageManager.getSession(),e=new i(t);t&&!e.isOutDated()?(this.currentSession=e,this.currentSession.updateLastEventTime(),this.setCurrentSessionAsPosted()):this.currentSession=new i,this.saveCurrentSession()},n.prototype.saveCurrentSession=function(){this._storageManager.setSession(this.currentSession.toString())},n.prototype.onSessionPost=function(t){this.currentSession.sessionUid=t,void 0===t&&(this.currentSession.stopSending=!0),this.saveCurrentSession()},n.prototype.shouldPostSession=function(){return!this.currentSession.stopSending&&(!!this._storageManager.isStorageEnabled&&(!this.lastPostedSession||!this.lastPostedSession.hasEqualsEventsTo(this.currentSession)))},n.prototype.addCtaEvent=function(){this.currentSession.recommendationEvent?this.currentSession.recoThenCtaEvents=!0:this.currentSession.ctaEvent=!0,this.currentSession.updateLastEventTime(),this.saveCurrentSession()},n.prototype.addRecommendationEvent=function(){this.currentSession.recommendationEvent=!0,this.currentSession.updateLastEventTime(),this.saveCurrentSession()},n.prototype.setCurrentSessionAsPosted=function(){this.lastPostedSession=new i(this.currentSession.toString())},t.exports=n},function(t,e){var s=function(t){t?this.fromString(t):(this.sessionUid=void 0,this.sessionStartTime=(new Date).getTime(),this.ctaEvent=!1,this.recommendationEvent=!1,this.recoThenCtaEvents=!1,this.lastEvent=(new Date).getTime(),this.stopSending=!1)};s.OUTDATING_TIME=18e5,s.prototype.toString=function(){var t={sessionStartTime:this.sessionStartTime,ctaEvent:this.ctaEvent,recommendationEvent:this.recommendationEvent,recoThenCtaEvents:this.recoThenCtaEvents,lastEvent:this.lastEvent,stopSending:this.stopSending};return this.sessionUid&&(t.sessionUid=this.sessionUid),JSON.stringify(t)},s.prototype.fromString=function(t){var e=JSON.parse(t);this.sessionStartTime=e.sessionStartTime,this.ctaEvent=e.ctaEvent,this.recommendationEvent=e.recommendationEvent,this.recoThenCtaEvents=e.recoThenCtaEvents,this.sessionUid=e.sessionUid,this.lastEvent=e.lastEvent,this.stopSending=e.stopSending},s.prototype.hasEqualsEventsTo=function(t){var e=!0;return e=e&&this.sessionStartTime===t.sessionStartTime,e=e&&this.ctaEvent===t.ctaEvent,e=e&&this.recommendationEvent===t.recommendationEvent,e=e&&this.recoThenCtaEvents===t.recoThenCtaEvents},s.prototype.isOutDated=function(){var t=(new Date).getTime();return t-this.lastEvent>s.OUTDATING_TIME},s.prototype.updateLastEventTime=function(){this.lastEvent=(new Date).getTime()},t.exports=s}]);