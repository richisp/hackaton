"use strict";function _toConsumableArray(n){return _arrayWithoutHoles(n)||_iterableToArray(n)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance");}function _iterableToArray(n){if(Symbol.iterator in Object(n)||Object.prototype.toString.call(n)==="[object Arguments]")return Array.from(n)}function _arrayWithoutHoles(n){if(Array.isArray(n)){for(var t=0,i=new Array(n.length);t<n.length;t++)i[t]=n[t];return i}}function _typeof(n){return _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},_typeof(n)}function _extends(){return _extends=Object.assign||function(n){for(var i,r,t=1;t<arguments.length;t++){i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(n[r]=i[r])}return n},_extends.apply(this,arguments)}function _possibleConstructorReturn(n,t){return t&&(_typeof(t)==="object"||typeof t=="function")?t:_assertThisInitialized(n)}function _getPrototypeOf(n){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},_getPrototypeOf(n)}function _assertThisInitialized(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function _inherits(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,writable:!0,configurable:!0}});t&&_setPrototypeOf(n,t)}function _setPrototypeOf(n,t){return _setPrototypeOf=Object.setPrototypeOf||function(n,t){return n.__proto__=t,n},_setPrototypeOf(n,t)}function _instanceof(n,t){return t!=null&&typeof Symbol!="undefined"&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](n):n instanceof t}function _classCallCheck(n,t){if(!_instanceof(n,t))throw new TypeError("Cannot call a class as a function");}function _defineProperties(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}function _createClass(n,t,i){return t&&_defineProperties(n.prototype,t),i&&_defineProperties(n,i),n}var draggable="$DraggableIdentificator$",DraggableUtils=function(){function n(t,i){_classCallCheck(this,n);this[draggable]=t;this.persistentDraggable=t;this.draggableContainer=i;var r=this.draggableContainer.getBoundingClientRect(),u=r.height,f=r.width;this.draggableArea={height:u,width:f};this.draggableOffsetLeft=0;this.draggableOffsetTop=0}return _createClass(n,[{key:"update",value:function(n,t){if(this[draggable]=n,this.persistentDraggable=n,t){this.draggableContainer=t;var i=this.draggableContainer.getBoundingClientRect(),r=i.height,u=i.width;this.draggableArea={height:r,width:u}}}},{key:"startDragging",value:function(n,t,i){this[draggable]=n;this.draggableOffsetLeft=t-this[draggable].offsetLeft;this.draggableOffsetTop=i-this[draggable].offsetTop}},{key:"whileDragging",value:function(n,t){if(this[draggable]!==null){var i=n-this.draggableOffsetLeft,r=t-this.draggableOffsetTop;this.move(this[draggable],i,r)}}},{key:"stopDragging",value:function(){this[draggable]=null}},{key:"reset",value:function(n){if(n=n||this.persistentDraggable,n===null||n===undefined)throw new Error("draggable element not found");(document.querySelector(".spill-one-column")===null||document.querySelector(".spill-one-column")===undefined)&&(n.style.top=this.draggableArea.height/2+"px",n.style.left=this.draggableArea.width/2+"px")}},{key:"move",value:function(n,t,i){if(n===null||n===undefined)throw new Error("draggable element not found");var r=n.getBoundingClientRect(),e=r.width,o=r.height,u=Math.round(e/2),s=(u-this.draggableArea.width)*-1,f=Math.round(o/2),h=(f-this.draggableArea.height)*-1;t<=u&&t>=s&&(n.style.left=t+"px");i<=f&&i>=h&&(n.style.top=i+"px")}}]),n}(),EventBroker=function(){function n(){_classCallCheck(this,n);this.subjects={};this.hasOwnProps=this.subjects.hasOwnProperty}return _createClass(n,[{key:"subscribe",value:function(n,t){var r=this,i;return this.hasOwnProps.call(this.subjects,n)||(this.subjects[n]=[]),i=this.subjects[n].push(t)-1,{remove:function(){return delete r.subjects[n][i]}}}},{key:"publish",value:function(n,t){this.hasOwnProps.call(this.subjects,n)&&this.subjects[n].forEach(function(n){return n(t)})}}]),n}(),ImageZoom=function(n){function t(n){var i;return _classCallCheck(this,t),i=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,n)),i.legendActiveClass="selected",i.depthSize=n.depthSize,i.popupContainerClass=n.format==="hw"?"hw-zoom-popup":"fr-zoom-popup",i.SelectedProductStore=Crate.React.Stores.SelectedProductStore,i.zoomAssistant=new ZoomAssistant(n.format,n.data.macro,n.isMobile,n.isPopupView,n.isCb2),i.eventBroker=new EventBroker,i.state={action:"in",zoomRound:0,showModal:!1,targetImg:n.data.imageSrc,images:n.data.images,hwIndex:0,currentIndex:n.data.legendCarouselSettings.initialSlide+1,infinite:!1},i.startDrag=i.startDrag.bind(_assertThisInitialized(i)),i.zoomInHandler=i.zoomInHandler.bind(_assertThisInitialized(i)),i.zoomOutHandler=i.zoomOutHandler.bind(_assertThisInitialized(i)),i.doubleClickHandler=i.doubleClickHandler.bind(_assertThisInitialized(i)),i.showDialog=i.showDialog.bind(_assertThisInitialized(i)),i.gotToSlideInternal=i.gotToSlideInternal.bind(_assertThisInitialized(i)),i.onBeforeChange=i.onBeforeChange.bind(_assertThisInitialized(i)),i.onAfterChange=i.onAfterChange.bind(_assertThisInitialized(i)),i.outwardImageChange=i.outwardImageChange.bind(_assertThisInitialized(i)),i.onThumbnailPressed=i.onThumbnailPressed.bind(_assertThisInitialized(i)),i.getCurrentTargetParentContainer=i.getCurrentTargetParentContainer.bind(_assertThisInitialized(i)),i.scaleZoomClass="scale-in-out",i.scaleSwitch=!1,i.tapedTwice=!1,i.isAnimating=!1,i}return _inherits(t,n),_createClass(t,[{key:"componentDidMount",value:function(){var n=this,i,r,t;if(this.SelectedProductStore.listen(this.outwardImageChange),this.setState({infinite:!0}),i=this.refs.draggableImage0||this.refs.draggableImage1,r=i.parentElement,this.du=new DraggableUtils(i,r),this.props.isMobile||(this.changeLegendCarouselSlide=this.eventBroker.subscribe("changePage",function(t){t>0?n.slider.slickNext():n.slider.slickPrev()})),this.resetDelegate=this.eventBroker.subscribe("reset",function(t){t===undefined?n.du.reset():n.du.reset(t)}),this.props.isMobile&&this.props.isPopupView)for(t in this.refs)t.indexOf("draggableImage")>=0&&this.refs[t].addEventListener("touchstart",function(t){return n.mobileDragEventHandler(t)}),t.indexOf("showcaseItemContainer")>=0&&(this.refs[t].addEventListener("touchmove",function(t){return n.du.whileDragging(t.clientX||t.touches[0].clientX,t.clientY||t.touches[0].clientY)}),this.refs[t].addEventListener("touchend",function(){return n.du.stopDragging()}));!!this.props.activeSlide&&this.props.activeSlide>=1&&setTimeout(function(){return n.showcaseSlider.slickGoTo(n.props.activeSlide)})}},{key:"componentDidUpdate",value:function(){var n=this.getCurrentTargetParentContainer(),t=this.activeFrameHeight,i=this.refs.imageZoomWrapper.classList;!!!t&&n&&n&&(n.style.height="".concat(Math.round(t),"px"));this.state.zoomRound>0?(i.add("showcase-item-zoomed"),n.style.height="".concat(Math.round(t),"px")):(i.remove("showcase-item-zoomed"),!this.props.isPopupView&&n&&(n.style.height="auto"))}},{key:"componentWillUnmount",value:function(){this.changeLegendCarouselSlide&&this.changeLegendCarouselSlide.remove();this.resetDelegate.remove();this.SelectedProductStore.unlisten(this.outwardImageChange)}},{key:"onThumbnailPressed",value:function(n){(n.keyCode==13||n.keyCode==32)&&(n.target.click(),n.preventDefault())}},{key:"showDialog",value:function(){var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:!1,i=React.createElement(t,{itemClass:this.props.itemClass,data:this.props.data,format:this.props.format,isMobile:this.props.isMobile,isPopupView:n,activeSlide:this.state.currentIndex-1,isCb2:this.props.isCb2});Crate.React.Actions.PopupActions.updateContent({content:i,containerClasses:["full-width","showcase-popup",this.popupContainerClass]})}},{key:"openVideo",value:function(n){Crate.React.Actions.PopupActions.updateContent({content:React.createElement(Video,{site:this.props.data.site,source:n}),containerClasses:["wide","showcase-video-popup",this.popupContainerClass]})}},{key:"zoomInHandler",value:function(){var n=this,t=this.getCurrentTargetParentContainer(),i=t.getBoundingClientRect(),r=i.height;this.activeFrameHeight=r;this.eventBroker.publish("reset");this.setState(function(t){return n.zoomAssistant.zoomStateManager("in",t,n.du.persistentDraggable.src)});this.du.stopDragging()}},{key:"zoomOutHandler",value:function(){var n=this;this.eventBroker.publish("reset");this.setState(function(t){return n.zoomAssistant.zoomStateManager("out",t,n.du.persistentDraggable.src)})}},{key:"doubleClickHandler",value:function(){}},{key:"gotToSlideInternal",value:function(n){var t=n.target.parentElement.getAttribute("data-index");this.showcaseSlider.slickGoTo(Number(t))}},{key:"onBeforeChange",value:function(){this.isAnimating=!0}},{key:"onAfterChange",value:function(n){var s=this,i,u,r,t,f,e,o;this.isAnimating=!1;i=this.state.currentIndex-1;this.setState({currentIndex:n+1});this.props.isMobile&&this.props.isPopupView&&(this.scaleSwitch=!1,u=document.querySelector(".".concat(this.scaleZoomClass)),u&&u.classList.remove(this.scaleZoomClass));r=this.refs["draggableImage".concat(i)];t=this.refs["draggableImage".concat(n)];_instanceof(t,ComfortVideo)&&!t.props.hasComfortVideo&&(this.setState({hwIndex:n>i?n-1:n+1}),this.openVideo(t.props.videoUrl));f=n>i?n:i;f%this.props.legendSlidesToShow==0&&this.eventBroker.publish("changePage",n>i?1:-1);_instanceof(r,ComfortVideo)||(r!==undefined&&(r.parentElement.style.height="auto"),this.eventBroker.publish("reset",r));_instanceof(t,ComfortVideo)||t!==undefined&&(this.du.update(t,t.parentElement),this.setState(function(){return{action:"in",zoomRound:0,targetImg:s.zoomAssistant.scaleImage(t.src,0)}}));this.props.isMobile||(e=this.refs["zoomMap".concat(n)],o=this.refs["zoomMap".concat(i)],e.classList.toggle(this.legendActiveClass),o.classList.toggle(this.legendActiveClass))}},{key:"startDrag",value:function(n){if(this.state.zoomRound===0)return!1;n.preventDefault();n.stopPropagation();this.du.startDragging(n.target,n.clientX,n.clientY)}},{key:"mobileDragEventHandler",value:function(n){var e=this,t,i;if(!this.tapedTwice)return this.tapedTwice=!0,setTimeout(function(){return e.tapedTwice=!1},300),!this.scaleSwitch||(t=n.clientX||n.touches[0].clientX,i=n.clientY||n.touches[0].clientY,n.preventDefault(),n.stopPropagation(),this.du.startDragging(n.target,t,i)),!1;n.preventDefault();n.stopPropagation();this.scaleSwitch=!this.scaleSwitch;var r=n.target.parentElement.offsetWidth-36,u=n.target.naturalWidth,o=r/u,f=u/r;this.isAnimating==!1&&(this.scaleSwitch?(this.refs.imageZoomWrapper.classList.add(this.scaleZoomClass),this.du.update(n.target,n.target.parentElement.parentElement),n.target.setAttribute("style","transform: translate(-50%, -50%) scale("+o+");"),n.target.style.pointerEvents="none",setTimeout(function(){n.target.style.transition=".3s transform ease-out";n.target.style.webkitTransform=".3s transform ease-out";n.target.style.transform="translate(-50%, -50%) scale(1)";n.target.style.webkitTransform="translate(-50%, -50%) scale(1)";n.target.style.pointerEvents="auto"},500)):(n.target.style.transition="none",n.target.style.webkitTransform="none",n.target.style.transform="scale("+f+")",n.target.style.webkitTransform="scale("+f+")",n.target.style.left="",n.target.style.top="",n.target.style.pointerEvents="none",this.refs.imageZoomWrapper.classList.remove(this.scaleZoomClass),setTimeout(function(){n.target.style.transition=".3s transform ease-out";n.target.style.webkitTransform=".3s transform ease-out";n.target.style.transform="scale(1)";n.target.style.webkitTransform="scale(1)";n.target.style.pointerEvents="auto"},500)))}},{key:"outwardImageChange",value:function(n){var f=this,t;if(n.selectedProduct&&n.selectedProduct.isPersonalized&&this.showcaseSlider.slickGoTo(0),t=this.state.images,n.selectedProduct.personalizedImageUrl){this.state.wasPersonalized?(t[0].portraitSrc=n.selectedProduct.personalizedImageUrl+"&$web_product_hero$",this.setState({images:t})):this.setState({wasPersonalized:!0,nonPersonalizedImage:t[0].portraitSrc},function(){t[0].portraitSrc=n.selectedProduct.personalizedImageUrl+"&$web_product_hero$";f.setState({images:t})});return}if(n.selectedProduct.personalizedImageUrl==null&&this.state.wasPersonalized){t[0].portraitSrc=this.state.nonPersonalizedImage;this.setState({images:t});return}if(n.selectedProduct.flatImage!==undefined){var r=t.length>1?1:0,i=t[r],u=n.selectedProduct.flatImage&&n.selectedProduct.flatImage.indexOf("outwardinc")>=0?"width=65&height=65&trim&bg=white":"$web_FurnitureProductThumbnail$";i.portraitSrc="".concat(n.selectedProduct.flatImage,"?").concat(this.props.data.macro);i.thumbNailSource=this.props.isCb2?"".concat(n.selectedProduct.flatImage,"&").concat(u):"".concat(n.selectedProduct.flatImage,"?").concat(u);Object.assign(t,i);this.setState({images:t,zoomRound:0,action:"in"});this.showcaseSlider.slickGoTo(r)}}},{key:"getCurrentTargetParentContainer",value:function(){var n=".slick-active.showcase-item-container",t=this.props.isPopupView?document.querySelector(".showcase-popup").querySelectorAll(n):document.querySelectorAll(n),i=this.props.isPopupView?document.querySelector(".showcase-popup").querySelector(n):document.querySelector(n);return this.state.currentIndex===1&&this.state.infinite?t[0]:this.state.currentIndex===this.state.images.length&&this.state.infinite?t[t.length>2?1:0]:i}},{key:"render",value:function(){var n=this,t={cursor:this.state.zoomRound===0?"auto":"move"},f=Object.assign(this.props.data.legendCarouselSettings,{draggable:this.props.itemClass=="less-item"&&!this.props.isMobile&&this.props.slidesToScroll>1?!1:!0,swipe:this.props.data.images.length>1,prevArrow:React.createElement("button",{className:"slick-arrow","aria-label":"Previous",onClick:this.props.onClick},React.createElement("svg",{className:"icon svg-icon-arrow-left","aria-hidden":"true",focusable:"false"},React.createElement("use",{xlinkHref:"#svg-icon-arrow-left"})),React.createElement("span",{className:"sr-only"},"Previous")),nextArrow:React.createElement("button",{className:"slick-arrow","aria-label":"Next",onClick:this.props.onClick},React.createElement("svg",{className:"icon svg-icon-arrow-right","aria-hidden":"true",focusable:"false"},React.createElement("use",{xlinkHref:"#svg-icon-arrow-right"})),React.createElement("span",{className:"sr-only"},"Next"))}),e=Object.assign(this.props.data.showcaseCarouselSettings,{draggable:this.props.itemClass=="less-item"&&!this.props.isMobile?!1:!0,lazyLoad:!0,infinite:this.props.isMobile?!1:!0,speed:600,afterChange:this.onAfterChange,beforeChange:this.onBeforeChange,prevArrow:React.createElement("button",{className:"slick-arrow","aria-label":"Previous",onClick:this.props.onClick},React.createElement("svg",{className:"icon svg-icon-arrow-left","aria-hidden":"true",focusable:"false"},React.createElement("use",{xlinkHref:"#svg-icon-arrow-left"})),React.createElement("span",{className:"sr-only"},"Previous")),nextArrow:React.createElement("button",{className:"slick-arrow","aria-label":"Next",onClick:this.props.onClick},React.createElement("svg",{className:"icon svg-icon-arrow-right","aria-hidden":"true",focusable:"false"},React.createElement("use",{xlinkHref:"#svg-icon-arrow-right"})),React.createElement("span",{className:"sr-only"},"Next"))}),o=function(r,u,f){return React.createElement("div",{onClick:function(){return n.showDialog(!0)}},React.createElement("img",{tabIndex:"-1",ref:"draggableImage"+u,className:"showcase-item",src:r.portraitSrc.indexOf("imagewtext")>0?r.portraitSrc:i(r.portraitSrc),style:t,alt:f}))},i=function(t){return n.state.zoomRound==0?n.zoomAssistant.scaleImage(t,0):n.state.targetImg},r=function(r,u,f){return React.createElement("div",{onDoubleClick:n.doubleClickHandler},React.createElement("img",{tabIndex:"-1",ref:"draggableImage"+u,className:"showcase-item",src:r.portraitSrc.indexOf("imagewtext")>0?r.portraitSrc:i(r.portraitSrc),onMouseDown:n.startDrag,style:t,alt:f}))},s=this.props.isMobile?{}:{onMouseMove:function(t){return n.du.whileDragging(t.clientX,t.clientY)},onMouseUp:function(){return n.du.stopDragging()},onMouseLeave:function(){return n.du.stopDragging()}},u=React.createElement("div",{className:"showcase-zoom-image"},React.createElement("span",{className:this.props.isPopupView?"tap-zoom-overlay":"sr-only"},"TAP TO ZOOM"),React.createElement(CrateSlickCarousel,_extends({onRef:function(t){n.showcaseSlider=t}},e,{focusSelector:"img"}),this.state.images.map(function(t,i){var u=n.props.data.name+" - Image "+(i+1)+" of "+n.state.images.length;return React.createElement("div",_extends({key:i,ref:"showcaseItemContainer".concat(i),className:"showcase-item-container"},s),t.isVideo?React.createElement("div",{className:"showcase-image-container"},t.isVideo&&!t.isComfort&&r(n.state.images[n.state.hwIndex],i),React.createElement(ComfortVideo,{ref:"draggableImage"+i,hasComfortVideo:t.isComfort,videoUrl:t.videoSource})):n.props.isMobile?o(t,i,u):r(t,i,u))})));return this.props.isMobile?React.createElement("div",{ref:"imageZoomWrapper"},this.props.isPopupView&&React.createElement("span",null,this.state.currentIndex,"/",this.props.data.images.length),u):React.createElement("div",{className:"showcase-widget"},React.createElement("div",{ref:"imageZoomWrapper",className:this.props.format=="furniture"?"showcase-item-furniture":"showcase-item-product"},u,React.createElement("div",{className:"showcase-nav-panel"},React.createElement("div",{className:"showcase-nav-controls"},React.createElement("button",{className:"view-full-screen",onClick:function(){return n.showDialog(!0)},style:{display:this.props.hasPopupMirror?"block":"none"}},React.createElement("svg",{className:"icon svg-icon-expand","aria-hidden":"true",focusable:"false"},React.createElement("use",{xlinkHref:"#svg-icon-expand"})),React.createElement("span",{className:"sr-only"},"View full screen")),React.createElement(ImageZoomControls,{onZoomIn:this.zoomInHandler,onZoomOut:this.zoomOutHandler,zoomStatus:{action:this.state.action,depthSize:this.depthSize,zoomRound:this.state.zoomRound}})),this.props.children,React.createElement("div",{className:"showcase-thumbnail "+this.props.itemClass},React.createElement(CrateSlickCarousel,_extends({onRef:function(t){n.slider=t}},f,{focusSelector:"img"}),this.state.images.map(function(t,i){return React.createElement("div",{key:i},React.createElement("img",{role:"button",tabIndex:"-1",className:i===n.props.data.legendCarouselSettings.initialSlide?n.legendActiveClass:"",ref:"zoomMap".concat(i),onClick:t.isVideo&&!t.isComfort?n.openVideo.bind(n,t.videoSource):n.gotToSlideInternal,src:t.thumbNailSource,alt:"View product image "+n.props.data.name+" - image "+(i+1)+" of "+n.state.images.length,onKeyDown:n.onThumbnailPressed}))}))))))}}]),t}(React.Component),SearchImageZoom;ImageZoom.defaultProps={hasPopupMirror:!1,depthSize:2,arrows:!0,isMobile:!1,isPopupView:!1,slideWidth:65,draggable:!1};var ImageZoomControls=function(n){function t(n){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,n))}return _inherits(t,n),_createClass(t,[{key:"render",value:function(){return React.createElement("span",null,this.props.children,React.createElement("button",{className:"zoom-in",onClick:this.props.onZoomIn,disabled:this.props.zoomStatus.action==="in"&&this.props.zoomStatus.zoomRound>=this.props.zoomStatus.depthSize},React.createElement("svg",{className:"icon svg-icon-zoom-in","aria-hidden":"true",focusable:"false"},React.createElement("use",{xlinkHref:"#svg-icon-zoom-in"})),React.createElement("span",{className:"sr-only"},"Enlarge product image size")),React.createElement("button",{className:"zoom-out",onClick:this.props.onZoomOut,disabled:this.props.zoomStatus.zoomRound===0},React.createElement("svg",{className:"icon svg-icon-zoom-out","aria-hidden":"true",focusable:"false"},React.createElement("use",{xlinkHref:"#svg-icon-zoom-out"})),React.createElement("span",{className:"sr-only"},"Reduce product image size")))}}]),t}(React.Component),MobileFullscreenImageView=function(n){function t(n){var i;return _classCallCheck(this,t),i=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,n)),i.state={imageSrc:n.src,productName:n.productName||"",altText:n.altText||""},i.dragEventHandler=i.dragEventHandler.bind(_assertThisInitialized(i)),i.scaleZoomClass="scale-in-out",i.scaleSwitch=!1,i.tapedTwice=!1,i}return _inherits(t,n),_createClass(t,[{key:"componentDidMount",value:function(){var n=this,t=this.refs.draggableImage,i=t.parentElement;this.du=new DraggableUtils(t,i);!this.refs.draggableImage||(this.refs.draggableImage.addEventListener("touchstart",function(t){return n.dragEventHandler(t)}),this.refs.fluidContainer.addEventListener("touchmove",function(t){return n.du.whileDragging(t.clientX||t.touches[0].clientX,t.clientY||t.touches[0].clientY)}),this.refs.fluidContainer.addEventListener("touchend",function(){return n.du.stopDragging()}))}},{key:"dragEventHandler",value:function(n){var r=this,t,i;if(!this.tapedTwice)return this.tapedTwice=!0,setTimeout(function(){return r.tapedTwice=!1},300),!this.scaleSwitch||(t=n.clientX||n.touches[0].clientX,i=n.clientY||n.touches[0].clientY,n.preventDefault(),n.stopPropagation(),this.du.startDragging(n.target,t,i)),!1;n.preventDefault();n.stopPropagation();this.scaleSwitch=!this.scaleSwitch;this.scaleSwitch?(this.refs.fluidContainer.classList.add(this.scaleZoomClass),this.du.update(n.target,n.target.parentElement)):this.refs.fluidContainer.classList.remove(this.scaleZoomClass)}},{key:"render",value:function(){return React.createElement("div",{ref:"fluidContainer"},React.createElement("div",{className:"showcase-zoom-image"},React.createElement("div",{className:"showcase-item-container"},React.createElement("img",{ref:"draggableImage",className:"showcase-item",src:this.state.imageSrc,"aria-hidden":"true",alt:"".concat(this.state.altText," ").concat(this.state.productName)}))))}}]),t}(React.Component),ScalableImage=function(n){function t(n){var i;return _classCallCheck(this,t),i=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,n)),i.fullscreenHandler=i.fullscreenHandler.bind(_assertThisInitialized(i)),i.srcFormataer=i.srcFormataer.bind(_assertThisInitialized(i)),i.stubToBeRemoved=i.stubToBeRemoved.bind(_assertThisInitialized(i)),i.closeFullScreenPopup=i.closeFullScreenPopup.bind(_assertThisInitialized(i)),i.tapDelay=500,i.hasTapDelay=!1,i}return _inherits(t,n),_createClass(t,[{key:"componentDidMount",value:function(){var n=this;!this.refs.scalableImage||this.refs.scalableImage.addEventListener("click",function(t){return n.props.simulatePopup?n.stubToBeRemoved(t):n.fullscreenHandler(t)});this.props.simulatePopup&&(this.specialOrderPopupContainer=document.getElementById("special-order-popup-container"),this.fullscreenImgCustomeLayerContainer=document.getElementById("fullscreen-img-custome-layer-container"),this.popupContainer=document.getElementById("popup-container"),this.scrollState=this.popupContainer.scrollTop)}},{key:"fullscreenHandler",value:function(n){var i=this,t;if(!this.hasTapDelay)return this.hasTapDelay=!0,setTimeout(function(){return i.hasTapDelay=!1,n.preventDefault(),n.stopPropagation(),!1},this.tapDelay);n.preventDefault();n.stopPropagation();t=this.srcFormataer(n);this.props.isMobile&&Crate.React.Actions.PopupActions.updateContent({content:t,containerClasses:["dimensions-popup"]})}},{key:"srcFormataer",value:function(n){var t=n.target.src;return!this.props.macros||(t=t.replace(/\$\w+\$/,this.props.macros)),React.createElement(MobileFullscreenImageView,{src:t,productName:"",altText:n.target.alt})}},{key:"stubToBeRemoved",value:function(n){this.specialOrderPopupContainer.classList.add("hidden");var t=React.createElement("div",null,React.createElement("button",{id:"popup-close",type:"button",className:"button button-secondary button-xl popup-close",title:"Close Popup",onClick:this.closeFullScreenPopup},React.createElement("span",{className:"sr-only"},"Close Popup"),React.createElement("svg",{className:"icon svg-icon-close","aria-hidden":"true",focusable:"false"},React.createElement("use",{xlinkHref:"#svg-icon-close"}))),React.createElement("div",{className:"full-screen-image"},this.srcFormataer(n)));ReactDOM.render(t,this.fullscreenImgCustomeLayerContainer);this.popupContainer.scrollTop=0;n.stopPropagation()}},{key:"closeFullScreenPopup",value:function(){ReactDOM.unmountComponentAtNode(this.fullscreenImgCustomeLayerContainer);this.specialOrderPopupContainer.classList.remove("hidden");this.popupContainer.scrollTop=this.scrollState}},{key:"render",value:function(){return React.createElement("img",{ref:"scalableImage",onClick:this.props.simulatePopup?this.stubToBeRemoved:this.fullscreenHandler,id:this.props.id,className:!!this.props.className&&this.props.className,"aria-hidden":"true",alt:this.props.alt,src:this.props.src})}}]),t}(React.Component);SearchImageZoom=function(n){function t(n){var i;return _classCallCheck(this,t),i=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,n)),i.legendActiveClass="selected",i.depthSize=n.depthSize,i.popupContainerClass=n.format==="hw"?"hw-zoom-popup":"fr-zoom-popup",i.zoomAssistant=new ZoomAssistant(n.format,n.data.macro,n.isMobile,n.isPopupView,n.isCb2),i.eventBroker=new EventBroker,i.state={action:"in",zoomRound:0,showModal:!1,hwIndex:0,currentIndex:n.data.legendCarouselSettings.initialSlide+1,infinite:!1},i.startDrag=i.startDrag.bind(_assertThisInitialized(i)),i.showDialog=i.showDialog.bind(_assertThisInitialized(i)),i.gotToSlideInternal=i.gotToSlideInternal.bind(_assertThisInitialized(i)),i.onBeforeChange=i.onBeforeChange.bind(_assertThisInitialized(i)),i.onAfterChange=i.onAfterChange.bind(_assertThisInitialized(i)),i.outwardImageChange=i.outwardImageChange.bind(_assertThisInitialized(i)),i.onThumbnailPressed=i.onThumbnailPressed.bind(_assertThisInitialized(i)),i.getCurrentTargetParentContainer=i.getCurrentTargetParentContainer.bind(_assertThisInitialized(i)),i.scaleZoomClass="scale-in-out",i.scaleSwitch=!1,i.tapedTwice=!1,i.isAnimating=!1,i}return _inherits(t,n),_createClass(t,[{key:"componentDidMount",value:function(){var n=this,i,r,t;if(this.setState({infinite:!0}),i=this.refs.draggableImage0||this.refs.draggableImage1,r=i.parentElement,this.du=new DraggableUtils(i,r),this.resetDelegate=this.eventBroker.subscribe("reset",function(t){t===undefined?n.du.reset():n.du.reset(t)}),this.props.isMobile&&this.props.isPopupView)for(t in this.refs)t.indexOf("draggableImage")>=0&&this.refs[t].addEventListener("touchstart",function(t){return n.mobileDragEventHandler(t)}),t.indexOf("showcaseItemContainer")>=0&&(this.refs[t].addEventListener("touchmove",function(t){return n.du.whileDragging(t.clientX||t.touches[0].clientX,t.clientY||t.touches[0].clientY)}),this.refs[t].addEventListener("touchend",function(){return n.du.stopDragging()}));!!this.props.activeSlide&&this.props.activeSlide>=1&&setTimeout(function(){return n.showcaseSlider.slickGoTo(n.props.activeSlide)})}},{key:"componentDidUpdate",value:function(){var n=this.getCurrentTargetParentContainer(),t=this.activeFrameHeight,i=this.refs.imageZoomWrapper.classList;!!!t&&n&&(t=n.getBoundingClientRect().height);this.state.zoomRound>0?(i.add("showcase-item-zoomed"),n&&(n.style.height="".concat(Math.round(t),"px"))):(i.remove("showcase-item-zoomed"),this.props.isPopupView||n&&(n.style.height="auto"))}},{key:"componentWillUnmount",value:function(){this.changeLegendCarouselSlide&&this.changeLegendCarouselSlide.remove();this.resetDelegate.remove()}},{key:"onThumbnailPressed",value:function(n){(n.keyCode==13||n.keyCode==32)&&(n.target.click(),n.preventDefault())}},{key:"showDialog",value:function(){var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:!1,i=React.createElement(t,{itemClass:this.props.itemClass,data:this.props.data,format:this.props.format,isMobile:this.props.isMobile,isPopupView:n,activeSlide:this.state.currentIndex-1,isKids:this.props.isKids,isCb2:this.props.isCb2});Crate.React.Actions.PopupActions.updateContent({content:i,containerClasses:["full-width","showcase-popup",this.popupContainerClass]})}},{key:"openVideo",value:function(n){Crate.React.Actions.PopupActions.updateContent({content:React.createElement(Video,{site:this.props.data.site,source:n}),containerClasses:["wide","showcase-video-popup",this.popupContainerClass]})}},{key:"gotToSlideInternal",value:function(n){var t=n.target.parentElement.getAttribute("data-index");this.showcaseSlider.slickGoTo(Number(t))}},{key:"onBeforeChange",value:function(){this.isAnimating=!0}},{key:"onAfterChange",value:function(n){var i,u,r,t,f;this.isAnimating=!1;i=this.state.currentIndex-1;this.setState({currentIndex:n+1});this.props.isMobile&&this.props.isPopupView&&(this.scaleSwitch=!1,u=document.querySelector(".".concat(this.scaleZoomClass)),u&&u.classList.remove(this.scaleZoomClass));r=this.refs["draggableImage".concat(i)];t=this.refs["draggableImage".concat(n)];_instanceof(t,ComfortVideo)&&!t.props.hasComfortVideo&&(this.setState({hwIndex:n>i?n-1:n+1}),this.openVideo(t.props.videoUrl));f=n>i?n:i;f%this.props.legendSlidesToShow==0&&this.eventBroker.publish("changePage",n>i?1:-1);_instanceof(r,ComfortVideo)||(r!==undefined&&(r.parentElement.style.height="auto"),this.eventBroker.publish("reset",r));_instanceof(t,ComfortVideo)||t!==undefined&&(this.du.update(t,t.parentElement),this.setState(function(){return{action:"in",zoomRound:0}}))}},{key:"startDrag",value:function(n){if(this.state.zoomRound===0)return!1;n.preventDefault();n.stopPropagation();this.du.startDragging(n.target,n.clientX,n.clientY)}},{key:"mobileDragEventHandler",value:function(n){var e=this,t,i;if(!this.tapedTwice)return this.tapedTwice=!0,setTimeout(function(){return e.tapedTwice=!1},300),!this.scaleSwitch||(t=n.clientX||n.touches[0].clientX,i=n.clientY||n.touches[0].clientY,n.preventDefault(),n.stopPropagation(),this.du.startDragging(n.target,t,i)),!1;n.preventDefault();n.stopPropagation();this.scaleSwitch=!this.scaleSwitch;var r=n.target.parentElement.offsetWidth-36,u=n.target.naturalWidth,o=r/u,f=u/r;this.isAnimating==!1&&(this.scaleSwitch?(this.refs.imageZoomWrapper.classList.add(this.scaleZoomClass),this.du.update(n.target,n.target.parentElement.parentElement),n.target.setAttribute("style","transform: translate(-50%, -50%) scale("+o+");"),n.target.style.pointerEvents="none",setTimeout(function(){n.target.style.transition=".3s transform ease-out";n.target.style.webkitTransform=".3s transform ease-out";n.target.style.transform="translate(-50%, -50%) scale(1)";n.target.style.webkitTransform="translate(-50%, -50%) scale(1)";n.target.style.pointerEvents="auto"},500)):(n.target.style.transition="none",n.target.style.webkitTransform="none",n.target.style.transform="scale("+f+")",n.target.style.webkitTransform="scale("+f+")",n.target.style.left="",n.target.style.top="",n.target.style.pointerEvents="none",this.refs.imageZoomWrapper.classList.remove(this.scaleZoomClass),setTimeout(function(){n.target.style.transition=".3s transform ease-out";n.target.style.webkitTransform=".3s transform ease-out";n.target.style.transform="scale(1)";n.target.style.webkitTransform="scale(1)";n.target.style.pointerEvents="auto"},500)))}},{key:"outwardImageChange",value:function(n){var t=this.props.data.images;if(n.selectedProduct.personalizedImageUrl){this.state.wasPersonalized?t[0].portraitSrc=n.selectedProduct.personalizedImageUrl:this.setState({wasPersonalized:!0,nonPersonalizedImage:t[0].portraitSrc},function(){t[0].portraitSrc=n.selectedProduct.personalizedImageUrl});return}if(n.selectedProduct.personalizedImageUrl==null&&this.state.wasPersonalized){t[0].portraitSrc=this.state.nonPersonalizedImage;return}if(n.selectedProduct.flatImage!==undefined){var r=1,i=t[r],u=n.selectedProduct.flatImage&&n.selectedProduct.flatImage.indexOf("outwardinc")>=0?"width=65&height=65&trim&bg=white":"$web_FurnitureProductThumbnail$";i.portraitSrc="".concat(n.selectedProduct.flatImage,"?").concat(this.props.data.macro);i.thumbNailSource=this.props.isCb2?"".concat(n.selectedProduct.flatImage,"&").concat(u):"".concat(n.selectedProduct.flatImage,"?").concat(u);Object.assign(t,i);this.setState({zoomRound:0,action:"in"});this.showcaseSlider.slickGoTo(r)}}},{key:"getCurrentTargetParentContainer",value:function(){var n=this.props.isPopupView?document.querySelector(".showcase-popup").querySelectorAll(".slick-active.showcase-item-container"):document.querySelectorAll(".slick-active.showcase-item-container"),t=this.props.isPopupView?document.querySelector(".showcase-popup").querySelector(".slick-active.showcase-item-container"):document.querySelector(".slick-active.showcase-item-container");return this.state.currentIndex===1&&this.state.infinite?n[0]:this.state.currentIndex===this.props.data.images.length&&this.state.infinite?n[n.length>1?1:0]:t}},{key:"render",value:function(){var n=this,t={cursor:this.state.zoomRound===0?"auto":"move"},r=Object.assign(this.props.data.showcaseCarouselSettings,{draggable:this.props.itemClass=="less-item"&&!this.props.isMobile?!1:!0,lazyLoad:!0,infinite:!1,speed:600,isKids:this.props.isKids,isSearch:!0,afterChange:this.onAfterChange,beforeChange:this.onBeforeChange,prevArrow:React.createElement("button",{className:"slick-arrow","aria-label":"Previous",onClick:this.props.onClick},React.createElement("svg",{className:"icon svg-icon-arrow-left","aria-hidden":"true",focusable:"false"},React.createElement("use",{xlinkHref:"#svg-icon-arrow-left"})),React.createElement("span",{className:"sr-only"},"Previous")),nextArrow:React.createElement("button",{className:"slick-arrow","aria-label":"Next",onClick:this.props.onClick},React.createElement("svg",{className:"icon svg-icon-arrow-right","aria-hidden":"true",focusable:"false"},React.createElement("use",{xlinkHref:"#svg-icon-arrow-right"})),React.createElement("span",{className:"sr-only"},"Next"))}),i=function(t){return n.state.zoomRound===0?n.zoomAssistant.scaleImage(t,0):n.props.data.imageSrc},u=function(n,r){return React.createElement("div",null,React.createElement("img",{tabIndex:"-1",ref:"draggableImage"+r,className:"showcase-item",src:n.portraitSrc.indexOf("imagewtext")>0?n.portraitSrc:i(n.portraitSrc),style:t,alt:n.thumbNailAlternate}))},f=function(r,u){return React.createElement("div",null,React.createElement("img",{tabIndex:"-1",ref:"draggableImage"+u,className:"showcase-item",src:r.portraitSrc.indexOf("imagewtext")>0?r.portraitSrc:i(r.portraitSrc),onMouseDown:n.startDrag,style:t,alt:r.thumbNailAlternate}))},e=React.createElement("div",{className:"showcase-zoom-image"},React.createElement(CrateSlickCarousel,_extends({onRef:function(t){n.showcaseSlider=t}},r,{focusSelector:"img"}),this.props.data.images.map(function(t,i){return React.createElement("div",{key:i,ref:"showcaseItemContainer".concat(i),className:"showcase-item-container"},t.isVideo?React.createElement("div",{className:"showcase-image-container"},t.isVideo&&!t.isComfort&&f(n.props.data.images[n.state.hwIndex],i),React.createElement(ComfortVideo,{ref:"draggableImage"+i,hasComfortVideo:t.isComfort,videoUrl:t.videoSource})):u(t,i))})));return React.createElement("div",{ref:"imageZoomWrapper"},this.props.isPopupView&&React.createElement("span",null,this.state.currentIndex,"/",this.props.data.images.length),e)}}]),t}(React.Component);SearchImageZoom.defaultProps={hasPopupMirror:!1,depthSize:2,arrows:!0,isMobile:!1,isPopupView:!1,slideWidth:65,draggable:!1};var TapToZoom=function(n){function t(n){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,n))}return _inherits(t,n),_createClass(t,[{key:"render",value:function(){return React.createElement("span",{className:"product-zoom-overlay"},React.createElement("i",{ref:"tapZoom",className:"tap-zoom"},"Tap To Zoom"))}}]),t}(React.Component),Video=function(n){var i=n.site,r=n.source,u=n.children,t=i==="Cb2"?"CB2":"Crate";return React.createElement("div",{className:"iframe-16x9"},React.createElement("iframe",{"aria-label":"Video",src:"https://images.crateandbarrel.com/s7viewers/html5/VideoViewer.html?config=".concat(t,"/Universal_HTML5_Video_FJ_Main_Carousel&asset=").concat(t,"/").concat(r)}),u)},type="$PageFormatIdentificator",ZoomAssistant=function(){function n(t,i,r,u,f){_classCallCheck(this,n);this.macros=i;this.isMobile=r;this.popupView=u;this[type]=t;this.defaultScales=[{w:1504,h:1504},{w:2e3,h:2e3}];this.isCb2=f}return _createClass(n,[{key:"enableCustomMacros",value:function(){this.customMacrosEnabled=!0}},{key:"zoomStateManager",value:function(n,t,i){var r=this.calculateDepth(t.action,n,t.zoomRound);return{action:n,zoomRound:r,targetImg:this.scaleImage(i,r)}}},{key:"calculateDepth",value:function(n,t,i){return t==="in"?i+1:i-1}},{key:"scaleImage",value:function(n,t){var i,r,e,o,u,s,h;if(n!==undefined&&n!==null){if(this.popupView&&this.isMobile)return n.replace("$web_zoom$","$web_product_lg$");if(n!==undefined&&(n.length<=0||n.indexOf("VideoViewer")>=0))return n;if(i=this.scales[t],r=n.indexOf("outwardinc")>=0?"width=".concat(i.w,"&height=").concat(i.h,"&padding=65&trim&bg=white"):"wid=".concat(i.w,"&hei=").concat(i.h),!this.isCb2&&n.indexOf("item_")>=0){var a=n.indexOf("outwardinc")<=-1,v=a?"$web_zoom_furn_colormap$":this.macros,y=n.indexOf("?")>=0?n.split("?")[0]:n;return"".concat(y,"?").concat(v,"&").concat(r)}if(this.isCb2&&n.indexOf("item_")>=0)return e=/\$[^\$]*\$/g.exec(n),o=e?e[0]:"",o!=""?(u=n.split(o),s=u[1].indexOf("/")>=0?/\/(.+)\//g.exec(u[1])[1]:u[1].split("&")[1],"".concat(u[0],"?").concat(s,"&").concat(r)):(h=n.split("&wid="),h[0]+"&"+r);var c=/\$[^\$]*\$/g.exec(n),l=c?c[0]:"",f=n.split(l),p=f[1].indexOf("/")>=0?/\/(.+)\//g.exec(f[1])[1]:f[1].split("&")[1];return"".concat(f[0],"?").concat(l,"&").concat(p,"&").concat(r)}}},{key:"zoom",value:function(n,t,i){if(n===null||n===undefined)throw new Error("target not found");i?this.zoomInOut(n,1.5):this.zoomInOut(n,.5);return}},{key:"zoomInOut",value:function(n,t){var i=n.getBoundingClientRect(),r=i.width,u=i.height;n.style.width=r*t+"px";n.style.height=u*t+"px";n=null}},{key:"scales",get:function(){return this.isMobile?[{w:450,h:450}].concat(_toConsumableArray(this.defaultScales)):this[type]==="hw"?[{w:625,h:625}].concat(_toConsumableArray(this.defaultScales)):[{w:1008,h:567}].concat(_toConsumableArray(this.defaultScales))}},{key:"initialState",get:function(){return{action:"in",zoomRound:0,showModal:!1}}}]),n}()