"use strict";function _instanceof(n,t){return t!=null&&typeof Symbol!="undefined"&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](n):n instanceof t}function _typeof(n){return _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},_typeof(n)}function _classCallCheck(n,t){if(!_instanceof(n,t))throw new TypeError("Cannot call a class as a function");}function _defineProperties(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}function _createClass(n,t,i){return t&&_defineProperties(n.prototype,t),i&&_defineProperties(n,i),n}function _possibleConstructorReturn(n,t){return t&&(_typeof(t)==="object"||typeof t=="function")?t:_assertThisInitialized(n)}function _getPrototypeOf(n){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},_getPrototypeOf(n)}function _assertThisInitialized(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function _inherits(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,writable:!0,configurable:!0}});t&&_setPrototypeOf(n,t)}function _setPrototypeOf(n,t){return _setPrototypeOf=Object.setPrototypeOf||function(n,t){return n.__proto__=t,n},_setPrototypeOf(n,t)}function _defineProperty(n,t,i){return t in n?Object.defineProperty(n,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[t]=i,n}var Curalate=function(n){function t(n){var i,r,u;return _classCallCheck(this,t),i=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,n)),_defineProperty(_assertThisInitialized(i),"handleLazyLoad",function(){i.setState({isLazyLoaded:!0},function(){i.getCuralateData()})}),_defineProperty(_assertThisInitialized(i),"loadCuralateScript",function(){var o=i.props.isCb2?i.constants.sites.cb2:i.constants.sites.crate,n=window.crl8=window.crl8||{},f=!1,e=[],u;n.ready=function(n){f?n():e.push(n)};n.pixel=n.pixel||function(){n.pixel.q.push(arguments)};n.pixel.q=n.pixel.q||[];var t=window.document,r=t.createElement("script"),s=n.debug||-1!==t.location.search.indexOf("crl8-debug=true")?"js":"min.js";r.src=t.location.protocol+"//cdn.curalate.com/sites/"+o+"/site/latest/site."+s;r.onload=function(){f=!0;e.forEach(function(n){n()})};u=t.getElementsByTagName("script")[0];u.parentNode.insertBefore(r,u.nextSibling)}),_defineProperty(_assertThisInitialized(i),"getCuralateData",function(){if(Crate!==undefined&&Crate.Services!==undefined&&Crate.Services.HttpService!==undefined){var n=i.constants.urls.crate;i.props.isKids&&(n=i.constants.urls.crateKids);i.props.isCb2&&(n=i.constants.urls.cb2);Crate.Services.HttpService.get(n+i.props.sku).then(function(n){i.setCuralateData(n)})}}),_defineProperty(_assertThisInitialized(i),"setCuralateData",function(n){i.setState({data:n.data,dataMap:i.mappedData(n.data)})}),_defineProperty(_assertThisInitialized(i),"mappedData",function(n){var t=i.constants.hashTags.crate;return i.props.isKids&&(t=i.constants.hashTags.crateKids),i.props.isCb2&&(t=i.constants.hashTags.cb2),n.items&&{items:n.items.map(function(n,t){return{imagePath:i.props.isMobile?n.media.smallSquare&&n.media.smallSquare.link:n.media.mediumSquare&&n.media.mediumSquare.link,id:t,itemId:n.id,imagePathLg:n.media.largeSquare&&n.media.largeSquare.link,products:n.products,source:n.source}}),piId:null,header:i.props.isCb2?"Share your style with ".concat(t):i.props.isMobile?"Show us your look with ".concat(t):"Customer Photos",subHeader:i.props.isCb2?"":i.props.isMobile?"":"Show us your look with ".concat(t)}}),_defineProperty(_assertThisInitialized(i),"handleClick",function(n){var t=i.renderPopupContent(n);Crate.React.Actions.PopupActions.updateContent({content:t,containerClasses:["curalate-zoom-popup","wide"]});i.props.isTrackingOn&&(i.setState({itemIndex:n,type:"item"}),i.initTracking(n))}),_defineProperty(_assertThisInitialized(i),"renderPopupContent",function(n){var t=i.constants.hashTags.crate,r;return i.props.isKids&&(t=i.constants.hashTags.crateKids),i.props.isCb2&&(t=i.constants.hashTags.cb2),r=i.constants.instagramHandle.crate,i.props.isCb2&&(r=i.constants.instagramHandle.cb2),React.createElement("div",{className:"curalate-popup-content"},React.createElement("div",{className:"content-left"},React.createElement("h3",{className:"user-name hidden-lg hidden-md"},"@",i.state.dataMap.items[n].source.user.username),React.createElement("img",{alt:"",src:i.state.dataMap.items[n].imagePathLg}),React.createElement("div",{className:"content-bottom"},React.createElement("span",{className:"caption"},"We love seeing what you bring home. Share photos using ",t," and ",r," for a chance to be featured. "))),React.createElement("div",{className:"content-right"},React.createElement("h3",{className:"user-name hidden-xs"},"@",i.state.dataMap.items[n].source.user.username),React.createElement("div",{className:"product-list-items"},React.createElement("span",{className:"sub-title"},"Products Shown"),i.state.dataMap.items[n].products.map(function(n,t){return React.createElement("h2",{"data-src":n.link,className:"product-list-item",key:t},React.createElement("a",{href:n.metadata.productId==i.props.sku?"#":n.link,title:n.name,onClick:function(){return i.props.isTrackingOn&&i.handleProductClick(t)}},React.createElement("img",{alt:"",src:n.images[0].smallSquare.link}),React.createElement("span",null,n.name)))}))))}),_defineProperty(_assertThisInitialized(i),"handleProductClick",function(n){i.setState({type:"product"});i.initTracking(n)}),_defineProperty(_assertThisInitialized(i),"whichSite",function(){return i.props.isCb2?"Cb2":i.props.isKids?"CrateKids":"Crate"}),_defineProperty(_assertThisInitialized(i),"whichId",function(){return i.props.isCb2?i.ids.cb2:i.props.isKids?i.ids.crateKids:i.ids.crate}),_defineProperty(_assertThisInitialized(i),"whichMetricsId",function(){return i.props.isCb2?"cb2":i.props.isKids?"landofnod":"crateandbarrel"}),_defineProperty(_assertThisInitialized(i),"getValues",function(){return{siteName:i.whichSite(),siteId:i.whichId(),metricsId:i.whichMetricsId()}}),_defineProperty(_assertThisInitialized(i),"initTracker",function(n){var t=i.getValues(),f=t.siteName,e=t.metricsId,r,u;typeof i.tracker=="undefined"&&(i.tracker=window.crl8.metrics.init("productPageCustomerPhotos".concat(f),{baseUrl:"//e.curalate.com/api/v1/metrics/experience",displayType:"pdp",metricsId:e,pixelName:"events.png",debug:!0}));r=i.tracker.config.fpcuid;u=i.tracker.config.rid;i.handleApi(r,u,n)}),_defineProperty(_assertThisInitialized(i),"handleApi",function(n,t,r){var u=i.getValues(),f=u.siteName,e=u.siteId,o="https://api-2.curalate.com/v1/media/".concat(e,"?rid=").concat(t,"&fpcuid=").concat(n);fetch(o).then(function(n){return n.json()}).then(function(){i.state.isClicked===!1&&(window.crl8.metrics.recordEvent({experienceId:"productPageCustomerPhotos".concat(f),eventName:"pageImpression"}),i.setState({isClicked:!0}));i.addEvents(r)})}),_defineProperty(_assertThisInitialized(i),"addEvents",function(n){i.state.type==="item"&&i.eventItemClick(n);i.state.type==="product"&&i.eventProductClick(n)}),_defineProperty(_assertThisInitialized(i),"eventItemClick",function(n){var t=i.getValues(),r=t.siteName,u=i.state.dataMap.items[n].itemId;window.crl8.metrics.recordEvent({experienceId:"productPageCustomerPhotos".concat(r),eventName:"itemClick",eventData:{itemId:u,position:n+1}})}),_defineProperty(_assertThisInitialized(i),"eventProductClick",function(n){var r=i.getValues(),u=r.siteName,t=i.state.itemIndex,f=i.state.dataMap.items[n].itemId,e=i.state.dataMap.items[t].products[n].metadata.productId,o=i.state.dataMap.items[t].products[n].id;window.crl8.metrics.recordEvent({experienceId:"productPageCustomerPhotos".concat(u),eventName:"productClick",eventData:{itemId:f,productId:e,productStyleId:o,position:n+1}})}),_defineProperty(_assertThisInitialized(i),"initTracking",function(n){i.state.scriptAdded?crl8.ready(function(){i.initTracker(n)}):(i.loadCuralateScript(),setTimeout(function(){crl8.ready(function(){i.initTracker(n)})},500),i.setState({scriptAdded:!0}))}),_defineProperty(_assertThisInitialized(i),"uploadPhotoClick",function(){if(i.state.scriptAdded)crl8.ready(function(){crl8.openUploader("custom-uploader")});else{var n=function(){setTimeout(function(){crl8.ready(function(){crl8.openUploader("custom-uploader")})},500)};i.loadCuralateScript();i.setState({scriptAdded:!0},function(){var t=i.constants.sites.crate,r;i.props.isCb2&&(t=i.constants.sites.cb2);r=setInterval(function(){var i="https://cdn.curalate.com/sites/".concat(t,"/experiences/custom-uploader-"),u=document.querySelector("script[src^='"+i+"']");u&&(n(),clearInterval(r))},300)})}}),i.state={data:"",dataMap:"",scriptAdded:!1,isClicked:!1,itemIndex:0,type:"",isLazyLoaded:!i.props.isLazyLoadComponent},r=n.isCanadaSite,u=r?"&locale=en-ca&":"&locale=en-us&",i.tracker,i.ids={crate:"UcYSlztmqOnLkjPZ",crateKids:"oLdiRXcOvdPLdily",cb2:"PzIbRoJCMfHrzMCe"},i.constants={urls:{crate:"https://api-2.curalate.com/v1/media/".concat(i.ids.crate,"?").concat(u,"filter=productId:"),crateKids:"https://api-2.curalate.com/v1/media/".concat(i.ids.crateKids,"?").concat(u,"filter=productId:"),cb2:"https://api-2.curalate.com/v1/media/".concat(i.ids.cb2,"?").concat(u,"filter=productId:")},sites:{crate:"cratebarrel-lrt3vc",cb2:"cb2-3r1xva"},hashTags:{crate:"#CrateStyle",crateKids:"#CrateKidsStyle",cb2:"#mycb2"},instagramHandle:{crate:r?"@CrateandBarrelCanada":"@CrateandBarrel",cb2:r?"@CB2Canada":"@Cb2"}},i}return _inherits(t,n),_createClass(t,[{key:"componentDidMount",value:function(){this.state.isLazyLoaded||Crate!==undefined&&Crate.Services!==undefined&&Crate.Services.HttpService!==undefined&&Crate.Services.LazyLoadService.watchReactElement(this.refs.curalateCarousel,this.handleLazyLoad,"500px 200px")}},{key:"render",value:function(){var n=this,t=this.props.isCb2?"Add Your Photos":"Add a Photo",i=React.createElement("div",{className:"button-upload-container"},React.createElement("button",{id:"uploader-btn",className:"button-transparent button-upload-photo",onClick:this.uploadPhotoClick},t)),r=this.state.isLazyLoaded&&this.state.dataMap&&React.createElement(Carousel,{role:"button",optionalHtml:i,isMobile:this.props.isMobile,defaultVersion:"true",json:this.state.dataMap,settings:this.props.settings,handleClick:function(t){return n.handleClick(t)},isCb2:this.props.isCb2});return React.createElement("section",{className:"section-region section-curalate"},React.createElement("div",{"data-crl8-container-id":"custom-uploader"}),React.createElement("div",{ref:"curalateCarousel"},r))}}]),t}(React.Component)