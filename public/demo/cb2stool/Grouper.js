"use strict";function _extends(){return _extends=Object.assign||function(n){for(var i,r,t=1;t<arguments.length;t++){i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(n[r]=i[r])}return n},_extends.apply(this,arguments)}function _instanceof(n,t){return t!=null&&typeof Symbol!="undefined"&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](n):n instanceof t}function _typeof(n){return _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},_typeof(n)}function _classCallCheck(n,t){if(!_instanceof(n,t))throw new TypeError("Cannot call a class as a function");}function _defineProperties(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}function _createClass(n,t,i){return t&&_defineProperties(n.prototype,t),i&&_defineProperties(n,i),n}function _possibleConstructorReturn(n,t){return t&&(_typeof(t)==="object"||typeof t=="function")?t:_assertThisInitialized(n)}function _getPrototypeOf(n){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},_getPrototypeOf(n)}function _assertThisInitialized(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function _inherits(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,writable:!0,configurable:!0}});t&&_setPrototypeOf(n,t)}function _setPrototypeOf(n,t){return _setPrototypeOf=Object.setPrototypeOf||function(n,t){return n.__proto__=t,n},_setPrototypeOf(n,t)}var Grouper=function(n){function t(n){var i;return _classCallCheck(this,t),i=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,n)),i.state={isPopupVisible:!1,isErrorMessageVisible:!1,selectedAttributesByGroup:{},availableProductsByAttribute:{}},i.onGrouperItemSelected=i.onGrouperItemSelected.bind(_assertThisInitialized(i)),i.showGrouperPopup=i.showGrouperPopup.bind(_assertThisInitialized(i)),i.handleStoreUpdated=i.handleStoreUpdated.bind(_assertThisInitialized(i)),i}return _inherits(t,n),_createClass(t,[{key:"componentWillMount",value:function(){var n={},t={},i=this.props.sku,r=this.props.isFamilyRollup;this.props.attributeGroups.forEach(function(u){n[u.id]=null;u.attributes.forEach(function(f){(!r||u.isPreselected)&&f.matchingSkus.includes(i)&&(n[u.id]=f.id);t[f.id]=f.matchingSkus})});this.setState({selectedAttributesByGroup:n,availableProductsByAttribute:t})}},{key:"componentDidMount",value:function(){Crate.React.Actions.GrouperActions.updateGrouperSelection(this.props.sku,this.props.isFamilyRollup);Crate.React.Stores.GrouperStore.listen(this.handleStoreUpdated)}},{key:"componentWillUnmount",value:function(){Crate.React.Stores.GrouperStore.unlisten(this.handleStoreUpdated)}},{key:"handleStoreUpdated",value:function(n){n.isErrorMessageVisible!==this.state.isErrorMessageVisible&&this.setState({isErrorMessageVisible:n.isErrorMessageVisible})}},{key:"onGrouperItemSelected",value:function(n,t){var i=this.state.selectedAttributesByGroup,s=this.state.availableProductsByAttribute,r,u,t,f,e,o;i[t]=n;r=[];u=!1;for(t in i){if(f=i[t],f===null){u=!0;continue}r.push(s[f])}e=r.shift().reduce(function(n,t){return n.indexOf(t)===-1&&r.every(function(n){return n.indexOf(t)!==-1})&&n.push(t),n},[]);o=e.length===1?e[0]:s[n][0];this.setState({selectedAttributesByGroup:i,isPopupVisible:!1});this.props.updateView(u,o);Crate.React.Actions.GrouperActions.updateGrouperSelection(o,u)}},{key:"showGrouperPopup",value:function(){this.setState({isPopupVisible:!0})}},{key:"render",value:function(){var n=this,i=this.props.attributeGroups[0].id,r=this.state.selectedAttributesByGroup[i],u=this.state.availableProductsByAttribute[r],f=this.props.attributeGroups.map(function(t){var r=t.id!==i?u:null;return React.createElement(GrouperCarousel,{key:t.id,id:t.id,displayName:t.name,attributes:t.attributes,skusToFilter:r,selectedAttributeId:n.state.selectedAttributesByGroup[t.id],onClick:n.onGrouperItemSelected,className:t.isImageAttributeGroup&&n.state.selectedAttributesByGroup[t.id]&&!n.props.isFurniture?"hidden-xs":"",isErrorMessageVisible:n.state.isErrorMessageVisible&&!n.state.selectedAttributesByGroup[t.id],isFurniture:n.props.isFurniture,isFurnNewExpEnabled:n.props.isFurnNewExpEnabled,isFurnNewExpConfigOn:n.props.isFurnNewExpConfigOn})}),e=this.props.isFurniture?this.props.attributeGroups.map(function(t){var i=t.attributes.find(function(i){return i.id==n.state.selectedAttributesByGroup[t.id]});return React.createElement("div",{className:"shop-bar-summary"},React.createElement("span",{className:"shop-bar-summary-item"},React.createElement("img",{className:"shop-bar-summary-item-img",src:i.imageUrl,height:"15",width:"30",alt:"","aria-hidden":"true"}),React.createElement("span",{className:"shop-bar-summary-item-text","aria-live":"polite"},React.createElement("span",{className:"shop-bar-summary-item-label"},t.name,":"),React.createElement("span",{className:"shop-bar-summary-item-description"},i.name))))}):null,t=this.props.attributeGroups.filter(function(n){return n.isImageAttributeGroup}).map(function(t){var i=t.attributes.filter(function(i){return i.id===n.state.selectedAttributesByGroup[t.id]});return i.length===0?null:t.attributes.length<=1?null:React.createElement(GrouperSelectedAttributeButton,{key:t.id,id:t.id,attributes:t.attributes,title:t.name,name:i[0].name,imageUrl:i[0].imageUrl,selectedAttributeId:n.state.selectedAttributesByGroup[t.id],onClick:n.onGrouperItemSelected,isPopupOpen:n.state.isPopupVisible,className:n.props.isFurniture?"hidden-xs":"visible-xs",popupContainerId:n.props.popupContainerId,pageContentContainerId:n.props.pageContentContainerId,isFurniture:n.props.isFurniture})}),o=t.some(function(n){return n!==null});return React.createElement("div",{className:"hw-right-grouper","data-id":this.props.id},React.createElement("span",{className:"grouper-title"}),t.length>0&&o&&!this.props.isFurniture&&React.createElement("h2",{className:"uline section-header visible-xs"},"Select Color"),!this.props.isFurniture&&t,React.createElement("ul",{className:"grouper-carousel color-bar-divided"},f),this.props.isFurniture&&e)}}]),t}(React.Component),GrouperAttribute=function(n){var t=n.isSelected?"jsGrouperSelection jsGrouperSelected":"jsGrouperSelection";return n.imageUrl?React.createElement("div",{key:n.id,"data-matchingskus":n.matchingSkus.join(),"data-attributeid":n.id,"data-attributegroupid":n.attributeGroupId,className:t},React.createElement("a",{className:"attribute-image",onClick:n.onClick},React.createElement("img",{src:n.imageUrl,alt:n.name,title:n.name}))):React.createElement("div",{key:n.id,"data-matchingskus":n.matchingSkus.join(),"data-attributeid":n.id,"data-attributegroupid":n.attributeGroupId,className:t},React.createElement("a",{onClick:n.onClick,className:"attribute-text "+(n.name.length>9?"long-attribute":"short-attribute")},n.name))},GrouperCarousel=function(n){var r=n.attributes.slice(),e=n.displayName.toLowerCase(),i=[],u=[],o=React.createElement("li",{className:"divider"}),t,f;if(n.isFurnNewExpEnabled?(r.forEach(function(t){t.skuProperty==0?i.push(React.createElement("li",{key:t.id,className:"stock-item"},React.createElement(GrouperAttribute,{id:t.id,matchingSkus:t.matchingSkus,attributeGroupId:n.id,imageUrl:t.imageUrl,name:t.name,isSelected:n.selectedAttributeId===t.id,onClick:function(){n.onClick(t.id,n.id)}}))):u.push(React.createElement("li",{key:t.id,className:"non-stock-item"},React.createElement(GrouperAttribute,{id:t.id,matchingSkus:t.matchingSkus,attributeGroupId:n.id,imageUrl:t.imageUrl,name:t.name,isSelected:n.selectedAttributeId===t.id,onClick:function(){n.onClick(t.id,n.id)}})))}),t=i.concat(o).concat(u),f=i.length):t=r.map(function(t){if(n.skusToFilter){var i=t.matchingSkus.filter(function(t){return n.skusToFilter.includes(t)});if(i.length===0)return null}return React.createElement("li",{key:t.id},React.createElement(GrouperAttribute,{id:t.id,matchingSkus:t.matchingSkus,attributeGroupId:n.id,imageUrl:t.imageUrl,name:t.name,isSelected:n.selectedAttributeId===t.id,onClick:function(){n.onClick(t.id,n.id)}}))}),t.length<=1)return null;var s=function(){var n=document.querySelectorAll(".stock-item.slick-active");document.querySelector(".color-bar-label-wrap").classList.remove("text-fade");n.length>0?document.querySelector(".color-bar-label-wrap").classList.add("stock-itme-visible"):document.querySelector(".color-bar-label-wrap").classList.remove("stock-itme-visible")},h=function(){var n=document.querySelectorAll(".stock-item.slick-active");n.length>0&&document.querySelector(".color-bar-label-wrap").classList.add("text-fade")},c={accessibility:!0,arrows:!0,dots:!1,infinite:!1,lazyLoad:!1,slidesToShow:n.isFurnNewExpEnabled?7:6,slidesToScroll:6,variableWidth:n.isFurnNewExpEnabled?!0:!1,draggable:!1,afterChange:n.isFurnNewExpEnabled?s:function(){},beforeChange:n.isFurnNewExpEnabled?h:function(){},prevArrow:React.createElement("button",{className:"slick-arrow","aria-label":"Previous",onClick:n.onClick},React.createElement("svg",{className:"icon svg-icon-arrow-left","aria-hidden":"true",focusable:"false"},React.createElement("use",{xlinkHref:"#svg-icon-arrow-left"})),React.createElement("span",{className:"sr-only"},"Previous")),nextArrow:React.createElement("button",{className:"slick-arrow","aria-label":"Next",onClick:n.onClick},React.createElement("svg",{className:"icon svg-icon-arrow-right","aria-hidden":"true",focusable:"false"},React.createElement("use",{xlinkHref:"#svg-icon-arrow-right"})),React.createElement("span",{className:"sr-only"},"Next")),responsive:[{breakpoint:768,settings:n.attributes.length<6?"unslick":{draggable:!0,dots:n.isFurniture?!1:!0,arrows:!1}}]};return React.createElement("li",{key:n.id,className:n.className},React.createElement("h2",{className:"uline section-header visible-xs"},"Select ",n.displayName),React.createElement("div",{id:"colorbar",className:"shop-bar-color-bar".concat(n.isFurnNewExpEnabled?" stock-"+f:" disable-divider")},React.createElement("div",{className:"color-bar-label-wrap stock-itme-visible"},React.createElement("div",{className:"left"},React.createElement("span",{className:"stocked"},"Quick Ship"),React.createElement("span",{className:"non-stocked"},"Allow Extra Time")),React.createElement("div",{className:"right"},React.createElement("span",{className:"non-stocked"},"Allow Extra Time"))),n.isFurniture?React.createElement("ul",{className:"grouper-attributes"},React.createElement(Slider,c,t)):React.createElement("ul",{className:"grouper-attributes grouper-attributes-".concat(e)},t),React.createElement("span",{className:"grouper-error-text-container ".concat(n.isErrorMessageVisible?"":"hidden")},React.createElement("svg",{className:"svg-icon-error","aria-hidden":"true",focusable:"false"},React.createElement("use",{xlinkHref:"#svg-icon-error"})),React.createElement("span",{className:"grouper-error"},"Please Select a ",n.displayName))))},GrouperContainer=function(n){function t(n){var i;return _classCallCheck(this,t),i=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,n)),i.updateView=i.updateView.bind(_assertThisInitialized(i)),i.unmountComponents=i.unmountComponents.bind(_assertThisInitialized(i)),i}return _inherits(t,n),_createClass(t,[{key:"updateView",value:function(n,t){var i=this,r=this,u=n?this.props.familyRollupUrl+t:this.props.productRollupUrl+t;if(Crate.React.Actions.AddToCartActions.reset(),Crate.React.Actions.HeaderActions.setPrefetched(!1),Crate.Services.HttpService.get(u).then(function(result){var container,piScript;result&&(container=document.querySelector(".jsRenderBody [data-cb-bind]"),Crate.React.Actions.AddToCartActions.removeProduct({Sku:i.props.sku}),r.unmountComponents(container),container.innerHTML=result,Crate.ComponentLoader.init(),piScript=document.getElementsByClassName("jsproduct-pi-data"),piScript&&piScript.length>0&&eval(piScript[0].innerHTML))}).then(function(){Crate.Services.HttpService.get(i.props.productRollupUrlJson+t).then(function(n){Crate.React.Actions.AnalyticsActions.fireGrouperChangeEvent(n)})}),this.props.onChange)this.props.onChange(n)}},{key:"componentDidUpdate",value:function(){var piScript=document.getElementById("ajaxCarouselScript");piScript&&eval(piScript.innerHTML)}},{key:"unmountComponents",value:function(n){for(var i=n.querySelectorAll("[data-reactroot]"),r,t=0;t<i.length;t++)r=i[t].parentNode,ReactDOM.unmountComponentAtNode(r)}},{key:"render",value:function(){return React.createElement(Grouper,_extends({},this.props,{updateView:this.updateView}))}}]),t}(React.Component),GrouperSelectedAttributeButton=function(n){function t(n){var i;return _classCallCheck(this,t),i=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,n)),i.state={isPopupOpen:!1},i.openPopup=i.openPopup.bind(_assertThisInitialized(i)),i}return _inherits(t,n),_createClass(t,[{key:"openPopup",value:function(){this.setState({isPopupOpen:!0})}},{key:"componentWillReceiveProps",value:function(n){this.setState({isPopupOpen:n.isPopupOpen})}},{key:"componentDidUpdate",value:function(){if(this.state.isPopupOpen){var n=document.createElement("div");ReactDOM.render(this.popupContent,n);Crate.React.Actions.PopupActions.updateContent({content:this.popupContent,title:"Selected ".concat(this.props.title),containerClasses:["grouper-selection-popup"]})}else Crate.React.Actions.PopupActions.toggleOpen(!1)}},{key:"render",value:function(){var t=React.createElement(GrouperCarousel,{key:this.props.id,id:this.props.id,displayName:"",attributes:this.props.attributes,selectedAttributeId:this.props.selectedAttributeId,onClick:this.props.onClick}),n;return this.popupContent=React.createElement("div",null,React.createElement("img",{src:this.props.imageUrl,alt:this.props.name,title:this.props.name,className:"selected-image"}),React.createElement("span",{className:"selected-swatch-name"},"Selected ",this.props.title,": ",this.props.name),React.createElement("ul",null,t)),n="selected-attribute-button col-xs-12",n+=this.props.isFurniture?" hidden-xs":" visible-xs",React.createElement("button",{className:n,type:"button",onClick:this.openPopup},React.createElement("img",{src:this.props.imageUrl,className:"attribute-image",alt:this.props.name}),React.createElement("p",{className:"selected-color"},this.props.title,": ",this.props.name,React.createElement("span",{className:"sr-only"},"currently selected.")),React.createElement("p",{className:"select-item-color"},"Select Another ",this.props.title))}}]),t}(React.Component)