"use strict";function _instanceof(n,t){return t!=null&&typeof Symbol!="undefined"&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](n):n instanceof t}function _typeof(n){return _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},_typeof(n)}function _classCallCheck(n,t){if(!_instanceof(n,t))throw new TypeError("Cannot call a class as a function");}function _defineProperties(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}function _createClass(n,t,i){return t&&_defineProperties(n.prototype,t),i&&_defineProperties(n,i),n}function _possibleConstructorReturn(n,t){return t&&(_typeof(t)==="object"||typeof t=="function")?t:_assertThisInitialized(n)}function _getPrototypeOf(n){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},_getPrototypeOf(n)}function _assertThisInitialized(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function _inherits(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,writable:!0,configurable:!0}});t&&_setPrototypeOf(n,t)}function _setPrototypeOf(n,t){return _setPrototypeOf=Object.setPrototypeOf||function(n,t){return n.__proto__=t,n},_setPrototypeOf(n,t)}function _defineProperty(n,t,i){return t in n?Object.defineProperty(n,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[t]=i,n}var DesignerRecommend=function(n){function t(n){var i;return _classCallCheck(this,t),i=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,n)),_defineProperty(_assertThisInitialized(i),"handleLazyLoad",function(){i.setState({isLazyLoaded:!0},function(){i.state.isStylitics&&i.getStyliticsData()})}),_defineProperty(_assertThisInitialized(i),"getStyliticsData",function(){i.getJsonP(i.constants.url+i.state.sku).then(function(n){i.setStyliticsData(n)})}),_defineProperty(_assertThisInitialized(i),"setStyliticsData",function(n){i.setState({data:n[0]})}),_defineProperty(_assertThisInitialized(i),"isStyliticsEnabled",function(){if(typeof optimizely!="undefined"&&typeof optimizely.get!="undefined"){var t=optimizely.get("state").getActiveExperimentIds(),r=t.find(function(n){return optimizely.get("data").experiments[n].name=="Test - Stylitics implementation"}),n=optimizely.get("state").getVariationMap()[r];!n||n.name!="Stylitics"||i.setState({isStylitics:!0})}}),i.state={isStylitics:!1,sku:n.sku,data:"",isLazyLoaded:!1},i.constants={url:"https://widget-api.stylitics.com/api/outfits?username=crateandbarrel&item_number="},i.handleSkuUpdated=i.handleSkuUpdated.bind(_assertThisInitialized(i)),i}return _inherits(t,n),_createClass(t,[{key:"componentDidMount",value:function(){this.state.isLazyLoaded||Crate!==undefined&&Crate.Services!==undefined&&Crate.Services.HttpService!==undefined&&Crate.Services.LazyLoadService.watchReactElement(this.refs.recommend,this.handleLazyLoad,"500px 200px");Crate.React.Stores.SelectedProductStore.listen(this.handleSkuUpdated);this.isStyliticsEnabled()}},{key:"componentWillUnmount",value:function(){Crate.React.Stores.SelectedProductStore.unlisten(this.handleSkuUpdated)}},{key:"getJsonP",value:function(n){return new Promise(function(t,i){var u="_"+Math.round(1e4*Math.random()),f="jsonp_callback_"+u,e,r;window[f]=function(n){delete window[f];var i=document.getElementById(u);i.parentNode.removeChild(i);t(n)};e=n+"&callback="+f;r=document.createElement("script");r.src=e;r.id=u;r.addEventListener("error",i);(document.getElementsByTagName("head")[0]||document.body||document.documentElement).appendChild(r)})}},{key:"handleSkuUpdated",value:function(n){n.selectedProduct&&this.setState({sku:n.selectedProduct.sku})}},{key:"render",value:function(){var n=this.state.isStylitics&&!this.props.isCb2&&this.state.data;return React.createElement("div",{className:"wrap",ref:"recommend"},n?React.createElement(Stylitics,{mainProductImageSrc:this.props.showcaseData.images[0].thumbNailSource,productName:this.props.showcaseData.name,selectedSku:this.state.sku,data:this.state.data}):this.props.json&&this.props.settings&&React.createElement(Carousel,{json:this.props.json,settings:this.props.settings,isInternational:this.props.isInternational,lineLevelMessage:this.props.lineLevelMessage,isCb2:this.props.isCb2,isLazyLoadComponent:!0}))}}]),t}(React.Component),Stylitics=function(n){function t(n){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,n))}return _inherits(t,n),_createClass(t,[{key:"componentDidMount",value:function(){Crate.Services.CookieService.setCookie("stylitics_viewed",!0)}},{key:"render",value:function(){var n=this,t=this.props.mainProductImageSrc.replace("&wid=60&hei=60","&wid=400&hei=400");return React.createElement("div",{id:"section-stylitics",className:"section-stylitics"},React.createElement("h2",{className:"section-header"},"Complete the Look"),React.createElement("div",{className:"section-tagline"},"Our Designers Recommend"),React.createElement("div",{className:"stylitics-main-image"},React.createElement("img",{src:t,alt:this.props.productName})),React.createElement("div",{className:"stylitics-recommended-image"},this.props.data&&this.props.data.items.map(function(t,i){if(t.remote_id.toString()!==n.props.selectedSku.toString()||t.remote_id.toString()!==n.props.data.primary_remote_id.toString())return React.createElement("div",{key:i,className:"recomended-image-wrap"},React.createElement("a",{className:"recomended-image-link",href:t.affiliate_link.split("?")[0]},React.createElement("img",{className:"recomended-image",src:t.large_image_url,alt:t.name})),React.createElement("div",{className:"recomended-image-details"},React.createElement("h3",{className:"detail-name"},t.name)))})))}}]),t}(React.Component)