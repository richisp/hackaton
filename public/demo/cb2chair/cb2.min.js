window.talkablePlacementsConfig = {"placements":[{"id":52160,"inclusion_matcher":{"blank":true},"inclusion_matchers":[{"blank":true}],"exclusion_matchers":[],"event_category":"purchase","device_types":["desktop","tablet","mobile"],"appearance":"popup","static_html":[]},{"id":52161,"inclusion_matcher":{"host_pattern":null,"query_pattern":{},"path_pattern":"/invite"},"inclusion_matchers":[{"host_pattern":null,"query_pattern":{},"path_pattern":"/invite"}],"exclusion_matchers":[],"event_category":"affiliate_member","device_types":["desktop","tablet","mobile"],"appearance":"inline","static_html":[]},{"id":52162,"inclusion_matcher":{"host_pattern":null,"query_pattern":{},"path_pattern":"/dashboard"},"inclusion_matchers":[{"host_pattern":null,"query_pattern":{},"path_pattern":"/dashboard"}],"exclusion_matchers":[],"event_category":"affiliate_member","device_types":["desktop","tablet","mobile"],"appearance":"inline","static_html":[]},{"id":52163,"inclusion_matcher":{"blank":true},"inclusion_matchers":[{"blank":true}],"exclusion_matchers":[],"event_category":"affiliate_member","device_types":["desktop","tablet","mobile"],"appearance":"gleam","static_html":[]},{"id":52164,"inclusion_matcher":{"blank":true},"inclusion_matchers":[{"blank":true}],"exclusion_matchers":[],"event_category":"affiliate_member","device_types":["desktop","tablet","mobile"],"appearance":"widget","static_html":[]}],"integration_id":"cb2","site_url":"http://www.cb2.com","timestamp":1587387329};
/*! cb2 | talkable-integration v2.3.2 | (c) Talkable | talkable.com */
Array.prototype.indexOf||(Array.prototype.indexOf=function(searchElement){if(void 0===this||null===this)throw TypeError();var t=Object(this),len=t.length>>>0;if(0===len)return-1;var n=0;if(arguments.length>0&&(n=Number(arguments[1]),isNaN(n)?n=0:0!==n&&n!==1/0&&n!==-(1/0)&&(n=(n>0||-1)*Math.floor(Math.abs(n)))),n>=len)return-1;for(var k=n>=0?n:Math.max(len-Math.abs(n),0);len>k;k++)if(k in t&&t[k]===searchElement)return k;return-1}),Array.isArray||(Array.isArray=function(arg){return"[object Array]"===Object.prototype.toString.call(arg)}),Object.keys||(Object.keys=function(){"use strict";var hasOwnProperty=Object.prototype.hasOwnProperty,hasDontEnumBug=!{toString:null}.propertyIsEnumerable("toString"),dontEnums=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],dontEnumsLength=dontEnums.length;return function(obj){if("object"!=typeof obj&&("function"!=typeof obj||null===obj))throw new TypeError("Object.keys called on non-object");var prop,i,result=[];for(prop in obj)hasOwnProperty.call(obj,prop)&&result.push(prop);if(hasDontEnumBug)for(i=0;dontEnumsLength>i;i++)hasOwnProperty.call(obj,dontEnums[i])&&result.push(dontEnums[i]);return result}}()),Array.prototype.forEach||(Array.prototype.forEach=function(callback,thisArg){var T,k;if(null==this)throw new TypeError("this is null or not defined");var O=Object(this),len=O.length>>>0;if("[object Function]"!=={}.toString.call(callback))throw new TypeError(callback+" is not a function");for(thisArg&&(T=thisArg),k=0;len>k;){var kValue;Object.prototype.hasOwnProperty.call(O,k)&&(kValue=O[k],callback.call(T,kValue,k,O)),k++}}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}),function(window,document,JSON,Object){function startListen(callback){log("startListen"),clearTimeout(url_interval),url_interval=setInterval(function(){var cur_url=document.location.href;cur_url!=old_url&&(log("url changed"),old_url?$(".jsLoading").is(":visible")?(old_url="reload",log("page is loading")):(callback(),old_url=cur_url):old_url=cur_url)},1e3)}function hideCouponOnCheckout(coupon){var $couponBox=$(".promo-code-form .success span"),$promoCodeBox=$('[aria-label="Promo Code Applied"]').next(),$appliedValueBox=$(".applied-promo-value, .applied-value"),hiddenCoupon=hideCoupon(coupon);$appliedValueBox.length>0&&$appliedValueBox.text(hiddenCoupon),$couponBox.length>0&&$couponBox.html($couponBox.html().replace(coupon,hiddenCoupon)),$promoCodeBox.length>0&&$promoCodeBox.html($promoCodeBox.html().replace(coupon,hiddenCoupon)),log("5: hide coupon")}function applyCoupon(coupon){var app=Crate.React.Actions.CartActions||Crate.React.Actions.CheckoutActions;app.applyPromoCode(coupon).then(function(){hideCouponOnCheckout(coupon)})}function getJsonFromUrl(){var result={};try{var query=location.search.substr(1);query.split("&").forEach(function(part){var item=part.split("=");result[item[0]]=decodeURIComponent(item[1])})}catch(e){log("7: getJsonFromUrl error",e)}return result}function getCookie(name){var matches=document.cookie.match(new RegExp("(?:^|; )"+name.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return matches?decodeURIComponent(matches[1]):""}function setCookie(name,value){document.cookie=name+"="+value+"; domain=.cb2.com; path=/;",document.cookie=name+"="+value+"; domain=.cb2.com; secure; path=/;",log("set cookie:",name,value)}function resetCookie(){var cookies=["tkbl_id","tkbl_user","tkbl_sa","tkbl_guser"];for(i=0;i<cookies.length;i++)document.cookie=cookies[i]+"=; path=/; domain=.cb2.com; expires=Thu, 01 Jan 1970 00:00:00 GMT",document.cookie=cookies[i]+"=; secure; path=/; domain=.cb2.com; expires=Thu, 01 Jan 1970 00:00:00 GMT",log("8: clear cookie",cookies[i]);clearTimeout(url_interval)}function isCurrentUrl(path){return path=path.toLowerCase(),log("10: check url path:",path,document.location.href.toLowerCase().indexOf(path)>-1),document.location.href.toLowerCase().indexOf(path)>-1}function hideCoupon(str){return str.toString().replace(/\d(?=\d{4})/g,"*")}function log(){var param=Array.prototype.slice.call(arguments);param.unshift("Talkable:"),(debug_mode||getCookie("tkbl_debug_mode"))&&console.log.apply(this,param)}function checkEmail(email,talkable_email){var isValid=!1;if(talkable_email==email)log("Valid email:",email),isValid=!0;else for(var iq=1;3>=iq;iq++){var current_email=getCookie("tkbl_mail_"+iq);if(!current_email){setCookie("tkbl_mail_"+iq,email),log("12: Added new email:",email,"attempt:",iq+"/3"),isValid=!0;break}if(current_email==email){log("Found invalid email:",email,"attempt:",iq+"/3"),isValid=!0;break}log("11: Invalid email:",email,"!=",current_email,"attempt:",iq+"/3")}isValid||(resetCookie(),log("Invalid email - RESET:",email,"attempt:",iq+"/3"))}function removeCSS(){if(c_id){var $cssContainer=$("#"+c_id);$cssContainer&&$cssContainer.length>0&&$cssContainer.remove()}}function checkAddress(sa){try{var cbSa=Crate.React.Stores.CheckoutStore&&Crate.React.Stores.CheckoutStore.state.singleShippingAddress,address=cbSa&&cbSa.address2+","+cbSa.address1+","+cbSa.city+","+cbSa.state+","+cbSa.zipCode+","+cbSa.country;if(address&&sa)for(var iw=0;iw<sa.length;iw++){var current_sa=prepareArray(sa[iw].toLowerCase()),current_address=prepareArray(address.toLowerCase()),similar=checkAddressSimilaritiesCount(current_sa,current_address);if(log('"'+sa[iw]+'"',' and "',address+'"'," similar to ",similar+"%"),similar>sa_similarity)return!0}}catch(e){log("13: sa error",e)}return!1}function checkAddressSimilaritiesCount(arrayA,arrayB){var matches=0;for(i=0;i<arrayA.length;i++)arrayA[i]&&-1!=arrayB.indexOf(arrayA[i])&&matches++;return matches/arrayA.length*100}function prepareArray(arr){for(var arr=arr.split(/[\s,]+/),ie=0;ie<arr.length;ie++)arr[ie]||(arr.splice(ie,1),ie--);return arr}function decodeString(val,sa){if(!val)return!1;try{if(val=atob(decodeURIComponent(val)),"undefined"!=typeof sa){var tkbl_sa=[];val=val.split("^");for(var ir=0;ir<val.length;ir++)tkbl_sa.push(val[ir].split(","))}}catch(e){val=!1}return val}function isCurrentPath(paths){for(var it=0;it<paths.length;it++)if(document.location.pathname.toLowerCase().indexOf(paths[it].toLowerCase())>-1)return!0;return!1}var talkable=window.curebit=window.talkable=function(){var customerData={},config={testing:!1,debug:!1,site_id:"",server:"https://www.talkable.com",version:"2.3.2",queue_check_interval:200,async:!1,url_length_limit:2e3,current_location:window.location.href,timeout:15,overrides:{init:{},register_affiliate:{},register_purchase:{},register_event:{}}},postmessage={send:function(json,target,targetElement){var self=this;if("undefined"==typeof target)throw new Error("You must supply a target as a string");"undefined"==typeof targetElement&&(targetElement=window.parent),targetElement.postMessage(self._serialize(json),target)},listen:function(callback){var self=this,receiveMessage=function(e){callback(self._unserialize(e.data))};window.addEventListener?window.addEventListener("message",receiveMessage,!1):window.attachEvent("onmessage",receiveMessage)},_unserialize:function(string){try{var o=JSON.parse(string);if(o&&"object"==typeof o&&null!==o)return o}catch(ex){return}},_serialize:function(obj){return JSON.stringify(obj)}},Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(input){var chr1,chr2,chr3,enc1,enc2,enc3,enc4,output="",i=0;for(input=Base64._utf8_encode(input);i<input.length;)chr1=input.charCodeAt(i++),chr2=input.charCodeAt(i++),chr3=input.charCodeAt(i++),enc1=chr1>>2,enc2=(3&chr1)<<4|chr2>>4,enc3=(15&chr2)<<2|chr3>>6,enc4=63&chr3,isNaN(chr2)?enc3=enc4=64:isNaN(chr3)&&(enc4=64),output=output+this._keyStr.charAt(enc1)+this._keyStr.charAt(enc2)+this._keyStr.charAt(enc3)+this._keyStr.charAt(enc4);return output},decode:function(input){var chr1,chr2,chr3,enc1,enc2,enc3,enc4,output="",i=0;for(input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");i<input.length;)enc1=this._keyStr.indexOf(input.charAt(i++)),enc2=this._keyStr.indexOf(input.charAt(i++)),enc3=this._keyStr.indexOf(input.charAt(i++)),enc4=this._keyStr.indexOf(input.charAt(i++)),chr1=enc1<<2|enc2>>4,chr2=(15&enc2)<<4|enc3>>2,chr3=(3&enc3)<<6|enc4,output+=String.fromCharCode(chr1),64!=enc3&&(output+=String.fromCharCode(chr2)),64!=enc4&&(output+=String.fromCharCode(chr3));return output=Base64._utf8_decode(output)},_utf8_encode:function(string){string=string.replace(/\r\n/g,"\n");for(var utftext="",n=0;n<string.length;n++){var c=string.charCodeAt(n);128>c?utftext+=String.fromCharCode(c):c>127&&2048>c?(utftext+=String.fromCharCode(c>>6|192),utftext+=String.fromCharCode(63&c|128)):(utftext+=String.fromCharCode(c>>12|224),utftext+=String.fromCharCode(c>>6&63|128),utftext+=String.fromCharCode(63&c|128))}return utftext},_utf8_decode:function(utftext){for(var string="",i=0,c=c1=c2=0;i<utftext.length;)c=utftext.charCodeAt(i),128>c?(string+=String.fromCharCode(c),i++):c>191&&224>c?(c2=utftext.charCodeAt(i+1),string+=String.fromCharCode((31&c)<<6|63&c2),i+=2):(c2=utftext.charCodeAt(i+1),c3=utftext.charCodeAt(i+2),string+=String.fromCharCode((15&c)<<12|(63&c2)<<6|63&c3),i+=3);return string}},utils={lastLoadedIframeName:[],gleamRewardCallback:void 0,log:function(message,source){"undefined"!=typeof window.console&&config.debug&&(source=source||"all-"+config.version,console.log(source+" >> "+message))},serialize:function(object,prefix){var i,key;if(!object)return"";if(!prefix&&!this.isObject(object))throw new Error("Url parameters should be a javascript hash");var s=[];if(this.isArray(object))for(i=0,object.length;i<object.length;++i)s.push(this.serialize(object[i],prefix+"[]"));else if(this.isObject(object)){for(key in object)if(this.hasProperty(object,key)){var prop=object[key];if(null!=prop){0===prop&&(prop=prop.toString()),null!=prefix&&(key=""+prefix+"["+key+"]");var fragment=this.serialize(prop,key);fragment&&s.push(this.serialize(prop,key))}}}else object&&s.push(""+encodeURIComponent(prefix.toString())+"="+encodeURIComponent(object.toString()));return s.length?s.join("&"):""},merge:function(target,src){var array=Array.isArray(src),dst=array&&[]||{};return array?(target=target||[],dst=dst.concat(target),src.forEach(function(e,i){"undefined"==typeof dst[i]?dst[i]=e:"object"==typeof e?dst[i]=utils.merge(target[i],e):-1===target.indexOf(e)&&dst.push(e)})):(target&&"object"==typeof target&&Object.keys(target).forEach(function(key){dst[key]=target[key]}),Object.keys(src).forEach(function(key){"object"==typeof src[key]&&src[key]&&target[key]?dst[key]=utils.merge(target[key],src[key]):dst[key]=src[key]})),dst},clone:function(object){return utils.merge(object,{})},subscribe:function(name,iframe_name,callback){postmessage.listen(function(message){if(message&&message.type==name&&callback){var container=document.getElementById(iframe_name);if(container&&(iframe_name=container.getElementsByTagName("iframe").length&&container.getElementsByTagName("iframe")[0].name),!message.iframe_name||iframe_name!=message.iframe_name)return;var iframe=document.querySelector("iframe[name='"+message.iframe_name+"']");if(!iframe)return;callback(message.data,iframe)}})},publish:function(name,iframe_name,data,is_global){var server=config.server,msg_data={type:name,iframe_name:iframe_name,data:data||{}};"undefined"!=typeof is_global&&is_global&&(server="*"),-1!==utils.lastLoadedIframeName.indexOf(iframe_name)&&window.frames[iframe_name]?postmessage.send(msg_data,server,window.frames[iframe_name]):this.subscribe("offer_loaded",iframe_name,function(data,iframe_data){iframe_data.name==iframe_name&&postmessage.send(msg_data,server,window.frames[iframe_name])})},notifyIntegrationError:function(message,dev){utils.addImage(utils.namespace(window.talkable.config.server,window.talkable.config.site_id)+"/notify_integration_error.gif?"+utils.serialize({message:message,dev:dev}))},isBrowserSupported:function(){return!(window.navigator.userAgent.indexOf("MSIE 6.0")>-1||window.navigator.userAgent.indexOf("MSIE 7.0")>-1)},getIframeCreationExtension:function(){return this.isBrowserSupported()?"html":"gif"},documentAppend:function(node){document.body.appendChild(node)},isObject:function(object){return"[object Object]"==this.getObjectType(object)},isArray:function(object){return"[object Array]"==this.getObjectType(object)},getObjectType:function(object){return Object.prototype.toString.call(object)},hasProperty:function(options,key){return options.hasOwnProperty(key)},setAttributes:function(element,attrs){for(var key in attrs)element.setAttribute(key,attrs[key])},location_parameters:function(){for(var vars={},current_location=config.current_location.split("#")[0],hashes=current_location.slice(current_location.indexOf("?")+1).split("&"),i=0;i<hashes.length;i++){var hash=hashes[i].split("=");"undefined"!=typeof hash[1]&&(vars[hash[0]]=decodeURIComponent(hash[1]))}return vars},location_parameter:function(name){return this.location_parameters()[name]},ensureInitialized:function(){if(!window.talkable.initialized)throw new Error("You need to call 'init' first")},namespace:function(server,site_id){return(server||config.server)+"/public/"+encodeURIComponent(site_id||config.site_id)},addImage:function(url){utils.log("addImage: "+url),document.images&&((new Image).src=url)},insertIframeIntoContainer:function(iframe,containerId){var containerEl=document.getElementById(containerId.replace("#",""));containerEl?(containerEl.innerHTML="",containerEl.appendChild(iframe)):this.domReady(function(){containerEl=document.getElementById(containerId.replace("#","")),containerEl?containerEl.innerHTML="":(containerEl=document.createElement("div"),containerEl.setAttribute("id",containerId),document.body.appendChild(containerEl)),containerEl.appendChild(iframe)})},addIframeElement:function(url,options){utils.log("addIframeElement: "+url),options=utils.clone(options||{}),options.frameBorder="0",options.allowTransparency=!0,options.src=url;var container=options.container||utils.generateRandomIframeName();delete options.container,utils.addRandomIframeName(options);var iframe=null,styleTag=null;return iframe=document.createElement("iframe"),iframe.style.display="none",iframe.style.opacity="0",this.setAttributes(iframe,options),this.insertIframeIntoContainer(iframe,container),utils.subscribe("responsive_iframe_height",iframe.name,function(data,iframe){iframe.style.height=data.height+"px"}),utils.subscribe("change_offer_state",iframe.name,function(data,iframe){data&&data.offer_state&&data.offer_state_attribute&&(data.width&&(iframe.style.width=data.width),data.height&&(iframe.style.height=data.height),currentAttribute=document.body.getAttribute(data.offer_state_attribute)||"","add"==data.action&&-1==currentAttribute.indexOf(data.offer_state)?document.body.setAttribute(data.offer_state_attribute,(data.offer_state+" "+currentAttribute).trim()):"remove"==data.action?document.body.setAttribute(data.offer_state_attribute,currentAttribute.replace(data.offer_state,"").trim()):"set"==data.action&&document.body.setAttribute(data.offer_state_attribute,data.offer_state),document.all&&!window.atob&&(document.body.className=document.body.className))}),utils.subscribe("set_location",iframe.name,function(data){data&&data.href&&-1==data.href.indexOf("javascript:")&&(window.location.href=data.href)}),utils.subscribe("offer_close",iframe.name,function(data,iframe){var index=utils.lastLoadedIframeName.indexOf(iframe.name);-1!=index&&utils.lastLoadedIframeName.splice(index,1),iframe.parentNode.removeChild(iframe),styleTag&&styleTag.parentNode.removeChild(styleTag),iframe=null,styleTag=null}),utils.subscribe("offer_loaded",iframe.name,function(data){if(utils.lastLoadedIframeName.push(iframe.name),data.perform_snapshot&&utils.scrapeDOM(),utils.gleamRewardCallback&&data.gleam_reward)try{utils.gleamRewardCallback(data.gleam_reward)}catch(ex){utils.log(ex)}iframe.style.display="block",setTimeout(function(){iframe.style.opacity="1"},0),data.integration_css&&data.integration_css.css&&(styleTag=document.createElement("style"),styleTag.id=data.integration_css.attribute_value,styleTag.type="text/css",styleTag.styleSheet?styleTag.styleSheet.cssText=data.integration_css.css:styleTag.appendChild(document.createTextNode(data.integration_css.css)),document.getElementById(data.integration_css.attribute_value)||document.body&&document.body.appendChild(styleTag),data.integration_css.attribute_name&&data.integration_css.attribute_value&&iframe.setAttribute(data.integration_css.attribute_name,data.integration_css.attribute_value))}),iframe},buildJs:function(url){var result=document.createElement("script");return result.type="text/javascript",result.async=config.async,result.src=url,result},addJs:function(url){utils.log("addJs: "+url);var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(utils.buildJs(url),s)},createUrl:function(path,parameters){var create_url=utils.namespace()+path,items=null;if(parameters=utils.merge({v:config.version},parameters),parameters.o&&parameters.o.i&&(items=parameters.o.i,delete parameters.o.i),create_url=create_url+"?"+utils.serialize(parameters),items)for(var i=0;i<items.length;i++){var item=items[i],itemsParams="&"+utils.serialize({product_id:item.product_id,price:item.price,quantity:item.quantity},"o[i]["+i+"]");(create_url+itemsParams).length<config.url_length_limit&&(create_url+=itemsParams)}return create_url},formIframe:function(options,url_path,url_parameters){if(options.responsive===!1)throw new Error("You cannot control responsive configuration option because it is deprecated. This option has been moved to Campaign configuration, you can access it at www.talkable.com");if(options.iframe.container&&options.iframe.container==options.trigger_widget.container)throw new Error("`trigger_widget` container should be different from `iframe` container.");this.fetchInternalIPIfNeeded(!options.iframe.container,function(internal_ip){url_path=url_path+"."+utils.getIframeCreationExtension();var templateOptions=utils.configureCampaignTemplate(options.campaign_template);url_parameters.campaign_tags=url_parameters.campaign_tags||templateOptions.campaign_tags,options=utils.merge(templateOptions,options),iframeOptions=utils.configureIframeOprions(url_parameters.campaign_tags,url_parameters.o&&url_parameters.o.order_number),options.iframe=utils.merge(iframeOptions,options.iframe),internal_ip&&url_parameters.o&&(url_parameters.o.internal_ip_address=internal_ip),url_parameters.o&&url_parameters.o.email&&(url_parameters.o.email=Base64.encode(url_parameters.o.email));var create_url=utils.createUrl(url_path,url_parameters);utils.showOffer(utils.merge(options,{url:create_url}))})},showOffer:function(options){if(utils.isBrowserSupported()){var iframe_options={},triggered_iframe_options={};options.trigger_widget&&options.trigger_widget.container?(iframe_options=options.trigger_widget,triggered_iframe_options=options.iframe):iframe_options=options.iframe;var iframe=utils.addIframeElement(options.url,iframe_options);utils.subscribe("offer_triggered",iframe.name,function(data){utils.addIframeElement(config.server+data.offer_share_path,triggered_iframe_options)})}else utils.addImage(options.url)},configureIframeOprions:function(campaign_tags,order_number){var name=null;return name="undefined"==typeof campaign_tags?"talkable-"+order_number:"string"==typeof campaign_tags?"talkable-"+campaign_tags:"talkable-"+campaign_tags[0],{container:name,name:name}},configureCampaignTemplate:function(template){if("string"!=typeof template)return{};var options={campaign_tags:[template],iframe:{container:"talkable-"+template,name:"talkable-"+template,width:"100%"}};return"popup"===template||"popup-trigger"===template||"new-visitor-popup"===template?(options.campaign_tags=["popup"],options.iframe.container="talkable-popup","popup-trigger"!==template&&"new-visitor-popup"!==template||(options.trigger_widget={name:"talkable-popup-trigger-widget-iframe",container:"talkable-popup-trigger-widget"})):"post-purchase"===template||"post-purchase-full-bleed"===template?(options.campaign_tags=["post-purchase"],options.iframe.container="talkable-post-purchase"):"invite"!==template&&"invite-full-bleed"!==template||(options.campaign_tags=["invite"],options.iframe.container="talkable-invite"),options},cleanupRegisterData:function(data){delete data.campaign_tags,delete data.device,delete data.verification_digest,delete data.iframe,delete data.campaign_template,delete data.trigger_widget,delete data.tkbl_expand},extractOriginData:function(data,key){var result;return this.hasProperty(data,key)?(result=utils.merge(data.customer||{},data[key]),delete data.customer):result=data,result},doubleIntegrationCheck:function(){var another_integration=window.curebit||window.talkable;another_integration&&utils.notifyIntegrationError("Another integration.js with version "+another_integration.config.version+" conflicts with current "+config.version+" on "+window.location.href)},internalIP:null,fetchInternalIPIfNeeded:function(skip_async,callback){return void(callback&&callback(null))},generateRandomIframeName:function(){return"talkable_integration_"+Math.random().toString(36).substring(2)},addRandomIframeName:function(params){var name=this.generateRandomIframeName();return params&&!params.name&&(params.name=name),name},scrapeDOM:function(){var iframeName=utils.lastLoadedIframeName[utils.lastLoadedIframeName.length-1];if(document.documentElement){var doctypeNode=document.doctype,doctypeString="<!DOCTYPE "+doctypeNode.name+(doctypeNode.publicId?' PUBLIC "'+doctypeNode.publicId+'"':"")+(!doctypeNode.publicId&&doctypeNode.systemId?" SYSTEM":"")+(doctypeNode.systemId?' "'+doctypeNode.systemId+'"':"")+">",domString=doctypeString;domString+="<html>",domString+=document.documentElement.innerHTML,domString+="</html>",this.publish("dom_capture",iframeName,{dom:domString,url:document.location.href})}},domReady:function(callback){var ready=!1,detach=function(){document.addEventListener?(document.removeEventListener("DOMContentLoaded",completed),window.removeEventListener("load",completed)):(document.detachEvent("onreadystatechange",completed),window.detachEvent("onload",completed))},completed=function(){ready||!document.addEventListener&&"load"!==event.type&&"complete"!==document.readyState||(ready=!0,detach(),callback())};if("complete"===document.readyState)callback();else if(document.addEventListener)document.addEventListener("DOMContentLoaded",completed),window.addEventListener("load",completed);else{document.attachEvent("onreadystatechange",completed),window.attachEvent("onload",completed);var top=!1;try{top=null==window.frameElement&&document.documentElement}catch(e){}top&&top.doScroll&&!function scrollCheck(){if(!ready){try{top.doScroll("left")}catch(e){return setTimeout(scrollCheck,50)}ready=!0,detach(),callback()}}()}}};utils.doubleIntegrationCheck();var methods={init:function(options){for(var key in options)utils.hasProperty(options,key)&&(config[key]=options[key]);if(!config.site_id)throw new Error("site_id must be specified!");this.initialized=!0},authenticate_customer:function(data){var registerData=utils.clone(data||{}),customer=registerData.customer?utils.clone(registerData.customer):registerData;utils.isObject(customer)&&(customerData=customer)},register_affiliate:function(data){utils.ensureInitialized();for(var registerData=utils.clone(data||{}),affiliate_member=registerData.customer||registerData.affiliate_member||{},options={iframe:registerData.iframe||{},trigger_widget:registerData.trigger_widget||{},campaign_template:registerData.campaign_template,responsive:registerData.responsive},url_parameters=["email","first_name","last_name","traffic_source"],i=0;i<url_parameters.length;i++){var parameter=url_parameters[i];utils.location_parameter(parameter)&&(affiliate_member[parameter]=utils.location_parameter(parameter))}var parameters={o:utils.merge(customerData,affiliate_member),campaign_tags:utils.location_parameter("campaign_tags")||registerData.campaign_tags,tkbl_expand:utils.location_parameter("tkbl_expand")};utils.formIframe(options,"/affiliate_members/create",parameters)},register_purchase:function(data){utils.ensureInitialized();var registerData=utils.clone(data||{}),purchase=utils.extractOriginData(registerData,"purchase");purchase.customer_email&&(purchase.email=purchase.customer_email,delete purchase.customer_email);var items=purchase.items;delete purchase.items;var options={iframe:registerData.iframe||{},trigger_widget:registerData.trigger_widget||{},campaign_template:registerData.campaign_template,responsive:registerData.responsive},campaign_tags=utils.location_parameter("campaign_tags")||registerData.campaign_tags,verification_digest=registerData.verification_digest;utils.cleanupRegisterData(registerData);var parameters={o:utils.merge(customerData,purchase),campaign_tags:campaign_tags,verification_digest:verification_digest};if(items){parameters.o.i=[];for(var i=0;i<items.length;i++){var item=items[i];parameters.o.i.push({product_id:item.product_id,price:item.price,quantity:item.quantity}),(item.url||item.image_url||item.title)&&methods._register_products([{product_id:item.product_id,url:item.url,image_url:item.image_url,title:item.title,price:item.price}])}}utils.formIframe(options,"/purchases/create",parameters)},register_event:function(data){utils.ensureInitialized();var registerData=utils.clone(data||{}),options={iframe:registerData.iframe||{},trigger_widget:registerData.trigger_widget||{},campaign_template:registerData.campaign_template,responsive:registerData.responsive},campaign_tags=utils.location_parameter("campaign_tags")||registerData.campaign_tags,verification_digest=registerData.verification_digest;utils.cleanupRegisterData(registerData);var event=utils.extractOriginData(registerData,"event"),parameters={o:utils.merge(customerData,event),campaign_tags:campaign_tags,verification_digest:verification_digest};utils.formIframe(options,"/events/create",parameters)},show_offer:function(options){utils.showOffer(options)},gleam_reward:function(data){utils.gleamRewardCallback=data.callback},_register_products:function(products){utils.ensureInitialized();for(var i=0;i<products.length;i++)utils.addImage(utils.createUrl("/products/create.gif",{p:products[i]}))}},before_methods={callbacks:{},register:function(method_name,callback){before_methods.callbacks[method_name]=callback}};return{initialized:!1,config:config,before:before_methods.register,methods:methods,domReady:utils.domReady,subscribe:utils.subscribe,publish:utils.publish,scrapeDOM:utils.scrapeDOM,check:function(){var _config,_delayedCallArgs;if("undefined"!=typeof _curebitq&&(_config=_curebitq),"undefined"!=typeof _talkableq&&(_config=_talkableq),_config)for(;_delayedCallArgs=_config.shift();){var method=_delayedCallArgs.shift();_delayedCallArgs[0]=utils.merge(_delayedCallArgs[0],talkable.config.overrides[method]||{}),(callback=before_methods.callbacks[method])&&(_delayedCallArgs[0]=callback.apply(talkable,_delayedCallArgs)),_delayedCallArgs[0]&&methods[method].apply(talkable,_delayedCallArgs)}},run:function(){talkable.check(),talkable._timer=setInterval(talkable.check,config.queue_check_interval)},_timer:null}}();_TALKABLE_PER_CLIENT_CONFIG={server:"https://share.cb2.com",environment:"prod",site_slug:"cb2",version:"2.3.2",deploy_protection:!1,without_integration_library:!1},window._talkableq=window._talkableq||[],_talkableq.unshift(["init",{site_id:_TALKABLE_PER_CLIENT_CONFIG.site_slug,server:_TALKABLE_PER_CLIENT_CONFIG.server}]);var _useTrigger=!1;window.talkable.before("register_affiliate",function(data){if(data){isCurrentPath(["/share","/invite"])?data.campaign_template="invite":isCurrentPath(["/dashboard"])?data.campaign_template="dashboard":_useTrigger&&(data.campaign_template="popup-trigger");var tpl=data.campaign_template;return"popup-trigger"===tpl||document.getElementById("talkable-"+tpl)?data:void window.talkable.domReady(function(){tpl&&document.getElementById("talkable-"+tpl)&&window._talkableq.push(["register_affiliate",data])})}}),window.talkable.before("register_purchase",function(data){return data.campaign_template="post-purchase",resetCookie(),data});var url_interval,old_url,debug_mode=!0,errorMessage="The contact information provided does not match with the promo code record.",sa_similarity=80;if("/"===document.location.pathname){var url_params=getJsonFromUrl(),cookie_coupon_code=url_params.tkbl_id,cookie_email=url_params.tkbl_se,cookie_sa=url_params.tkbl_sa,cookie_campaign_id=url_params.utm_campaign;if(cookie_email&&cookie_coupon_code){var tkbl_campaign_id=getCookie("tkbl_campaign_id");tkbl_campaign_id!=cookie_campaign_id?(log("save user data"),setCookie("tkbl_id",cookie_coupon_code),setCookie("tkbl_user",cookie_email),setCookie("tkbl_sa",cookie_sa),setCookie("tkbl_campaign_id",cookie_campaign_id)):log("prevent double save")}}var coupon=getCookie("tkbl_id"),email=getCookie("tkbl_user"),sa=getCookie("tkbl_sa"),c_id=getCookie("tkbl_campaign_id"),guestEmail=getCookie("tkbl_guser"),accountEmail=pageData.account&&pageData.account.email;!function additionalFraudDetection(){if(log("Start checking"),coupon=getCookie("tkbl_id"),email=getCookie("tkbl_user"),sa=getCookie("tkbl_sa"),c_id=getCookie("tkbl_campaign_id"),guestEmail=getCookie("tkbl_guser"),accountEmail=pageData.account&&pageData.account.email,coupon&&email){coupon=decodeString(coupon),email=decodeString(email),sa=decodeString(sa,!0);var isNotValidEmail=accountEmail&&email!=accountEmail&&"guest"!=accountEmail||guestEmail&&email!=guestEmail,isNotValidSa=!isNotValidEmail&&isCurrentUrl("checkout")&&checkAddress(sa);window.talkable.domReady(function(){try{if((isCurrentUrl("checkout/cart")&&pageData.items||isCurrentUrl("checkout/paymentandbilling")||isCurrentUrl("checkout/review"))&&coupon&&email)if(isNotValidEmail||isNotValidSa){if(log("is not valid email:",isNotValidEmail),log("is not valid sa:",isNotValidSa),Crate.Model.basket&&Crate.Model.basket.DiscountCode||Crate.Model.OrderSummary&&Crate.Model.OrderSummary.PromoCode){Crate.React.Actions.CartActions&&"function"==typeof Crate.React.Actions.CartActions.removePromoCode&&Crate.React.Actions.CartActions.removePromoCode(),Crate.React.Actions.CheckoutActions&&"function"==typeof Crate.React.Actions.CheckoutActions.removePromoCode&&Crate.React.Actions.CheckoutActions.removePromoCode(),log("remove coupon",coupon);var $errorBox=$(".order-summary");$(".cart-order-summary .promo-code-form").length&&($errorBox=$(".cart-order-summary .promo-code-form")),$("#txtPromoCode").length&&($errorBox=$("#txtPromoCode").parent(),$('[aria-expanded="false"][aria-controls="promo-code-accordion"]').trigger("click")),$errorBox.append('<div id="promo-error-message" class="field-validation-error promo-error-message">'+errorMessage+"</div>")}var current_user_email=pageData.account&&"guest"!=pageData.account.email&&pageData.account.email||Crate.Model&&Crate.Model.BillingAddress&&Crate.Model.BillingAddress.Email;isNotValidSa?resetCookie():current_user_email&&checkEmail(current_user_email,email)}else{var $couponMessage=$('[aria-label="Promo Code Applied"]');0==$couponMessage.length&&isCurrentUrl("checkout")&&(applyCoupon(coupon),log("apply coupon"))}isCurrentUrl("account/login")&&email&&($("#email").val(email),log("fill email")),isCurrentUrl("account/create")&&email&&($("#txtEmail").val(email),log("fill email")),isCurrentUrl("checkout")&&email&&(hideCouponOnCheckout(coupon),startListen(function(){hideCouponOnCheckout(coupon),additionalFraudDetection()},email)),isCurrentUrl("shippingandgiftoptions")&&email&&$("#receiptEmail").on("change",function(){setCookie("tkbl_guser",$(this).val())})}catch(e){log("6: auto apply error",e)}removeCSS(),removeCSS(),log("removeCSS")})}}();talkable.run()}(window,document,JSON,Object);